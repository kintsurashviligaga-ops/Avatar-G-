<!DOCTYPE html>
<html lang="ka">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0" />
  <meta name="theme-color" content="#0b1020" />
  <meta name="description" content="Avatar G ‚Äî ·É°·Éê·É•·Éê·É†·Éó·Éï·Éî·Éö·Éù·É° ·Éû·Éò·É†·Éï·Éî·Éö·Éò AI Workspace. Chat, Create, Generate - ·Éß·Éï·Éî·Éö·Éê·É§·Éî·É†·Éò ·Éî·É†·Éó ·É°·Éò·Éï·É†·É™·Éî·É®·Éò." />
  <meta name="keywords" content="AI, Avatar, Video, Voice, Music, Georgian AI, ·É•·Éê·É†·Éó·É£·Éö·Éò AI, AI Workspace" />
  <meta property="og:title" content="Avatar G ‚Äî AI Workspace" />
  <meta property="og:description" content="Georgian AI-powered Media Factory. Professional content generation with AI assistance." />
  <meta property="og:type" content="website" />
  <meta name="twitter:card" content="summary_large_image" />
  <title>Avatar G ‚Äî AI Workspace</title>

  <style>
    :root{
      --bg0:#060815;
      --bg1:#0b1020;
      --bg2:#10172a;
      --glass:rgba(255,255,255,.08);
      --glass2:rgba(255,255,255,.12);
      --stroke:rgba(255,255,255,.14);
      --strokeHover:rgba(34,211,238,.35);
      --text:#e5e7eb;
      --textBright:#f9fafb;
      --muted:#93a3b8;
      --shadow:0 24px 80px rgba(0,0,0,.45);
      --shadowHover:0 28px 90px rgba(0,0,0,.55);
      --radius:18px;
      --radiusSm:14px;
      --brand:#22d3ee;
      --brand2:#3b82f6;
      --brandGrad:linear-gradient(135deg, rgba(34,211,238,.95), rgba(59,130,246,.95));
      --ok:#22c55e;
      --warn:#f59e0b;
      --danger:#ef4444;
      --purple:#a855f7;
      --transition:all .24s cubic-bezier(.4,0,.2,1);
      --transitionFast:all .16s cubic-bezier(.4,0,.2,1);
    }

    *{box-sizing:border-box;margin:0;padding:0}
    html{scroll-behavior:smooth}
    html,body{height:100%;overflow:hidden}
    body{
      font-family:ui-sans-serif,system-ui,-apple-system,"SF Pro Display","Segoe UI",Roboto,"Noto Sans Georgian",sans-serif;
      color:var(--text);
      background:
        radial-gradient(1100px 650px at 18% 8%, rgba(34,211,238,.24), transparent 58%),
        radial-gradient(950px 650px at 82% 18%, rgba(59,130,246,.20), transparent 58%),
        radial-gradient(950px 750px at 50% 85%, rgba(34,197,94,.12), transparent 62%),
        linear-gradient(180deg, var(--bg1) 0%, var(--bg0) 100%);
      background-attachment:fixed;
      line-height:1.6;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    ::selection{background:rgba(34,211,238,.25);color:var(--textBright)}
    button{font-family:inherit;cursor:pointer;border:none;outline:none}
    input,textarea,select{font-family:inherit}

    .app{display:flex;flex-direction:column;height:100vh;overflow:hidden}

    .header{
      flex:0 0 auto;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:14px;
      padding:14px 18px;
      border-bottom:1px solid var(--stroke);
      background:linear-gradient(135deg, rgba(255,255,255,.11), rgba(255,255,255,.07));
      backdrop-filter:blur(16px) saturate(180%);
      -webkit-backdrop-filter:blur(16px) saturate(180%);
      box-shadow:0 4px 24px rgba(0,0,0,.15);
      z-index:100;
    }

    .brand{
      display:flex;align-items:center;gap:12px;cursor:pointer;
      transition:var(--transitionFast);
      outline:none;border-radius:12px;padding:4px 8px 4px 4px;
    }
    .brand:hover{background:rgba(255,255,255,.06)}
    .brand:focus-visible{box-shadow:0 0 0 3px rgba(34,211,238,.18)}

    .logo{
      width:42px;height:42px;border-radius:12px;display:grid;place-items:center;
      background:var(--brandGrad);
      color:#071018;font-weight:900;font-size:18px;
      box-shadow:0 12px 40px rgba(34,211,238,.22);
      flex:0 0 auto;
      user-select:none;
    }

    .brandtext{display:flex;flex-direction:column;line-height:1.15}
    .title{font-weight:800;font-size:15px;color:var(--textBright);letter-spacing:.3px}
    .subtitle{font-size:11px;color:var(--muted)}

    .headerRight{display:flex;align-items:center;gap:10px;flex-wrap:wrap;justify-content:flex-end}

    .creditBadge{
      display:flex;align-items:center;gap:8px;padding:8px 12px;
      background:rgba(255,255,255,.06);
      border:1px solid var(--stroke);
      border-radius:999px;
      font-size:12.5px;font-weight:800;color:var(--brand);
      transition:var(--transitionFast);
      white-space:nowrap;
    }
    .creditBadge:hover{background:rgba(255,255,255,.09)}
    .creditBadge span{color:var(--text)}

    .miniBtn{
      padding:9px 12px;
      background:rgba(255,255,255,.06);
      border:1px solid var(--stroke);
      border-radius:12px;
      font-weight:800;font-size:12.5px;color:var(--text);
      transition:var(--transitionFast);
      white-space:nowrap;
    }
    .miniBtn:hover{background:rgba(255,255,255,.10);border-color:var(--strokeHover);transform:translateY(-1px)}
    .miniBtn:active{transform:translateY(0)}

    .selectWrap{position:relative}
    .select{
      appearance:none;
      padding:9px 32px 9px 12px;
      background:rgba(255,255,255,.06);
      border:1px solid var(--stroke);
      border-radius:12px;
      color:var(--text);
      font-weight:800;font-size:12.5px;
      cursor:pointer;outline:none;
      transition:var(--transitionFast);
    }
    .select:hover{background:rgba(255,255,255,.09);border-color:var(--strokeHover)}
    .select:focus{border-color:var(--brand);box-shadow:0 0 0 3px rgba(34,211,238,.15)}
    .selectWrap:after{
      content:"‚ñæ";
      position:absolute;right:10px;top:50%;transform:translateY(-50%);
      color:var(--muted);pointer-events:none;font-size:12px;
    }

    .container{flex:1 1 auto;display:flex;overflow:hidden;position:relative}

    .sidebar{
      flex:0 0 280px;
      display:flex;flex-direction:column;gap:12px;
      padding:16px;
      border-right:1px solid var(--stroke);
      background:rgba(255,255,255,.03);
      overflow-y:auto;
    }

    .sidebarTitle{
      font-size:13px;font-weight:900;color:var(--muted);
      letter-spacing:.8px;text-transform:uppercase;
      margin-bottom:6px;padding:0 4px;
      display:flex;align-items:center;justify-content:space-between;gap:10px;
    }

    .activeChip{
      font-size:10px;font-weight:900;
      padding:4px 8px;border-radius:999px;
      background:rgba(34,211,238,.14);
      border:1px solid rgba(34,211,238,.28);
      color:var(--brand);
      letter-spacing:.5px;
      white-space:nowrap;
    }

    .serviceCard{
      padding:14px;
      background:linear-gradient(135deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
      border:1px solid var(--stroke);
      border-radius:var(--radiusSm);
      cursor:pointer;
      transition:var(--transition);
      position:relative;overflow:hidden;
      outline:none;
    }
    .serviceCard:hover{
      background:linear-gradient(135deg, rgba(255,255,255,.13), rgba(255,255,255,.08));
      border-color:var(--strokeHover);
      transform:translateX(3px);
    }
    .serviceCard:active{transform:translateX(1px)}
    .serviceCard:focus-visible{box-shadow:0 0 0 3px rgba(34,211,238,.18)}
    .serviceCard.active{
      border-color:rgba(34,211,238,.55);
      box-shadow:0 10px 40px rgba(34,211,238,.10);
      background:linear-gradient(135deg, rgba(34,211,238,.14), rgba(59,130,246,.09));
    }

    .serviceCard::before{
      content:'';
      position:absolute;left:0;top:0;bottom:0;width:3px;
      background:var(--brand);opacity:0;transition:opacity .2s ease;
    }
    .serviceCard:hover::before, .serviceCard.active::before{opacity:1}

    .serviceTop{display:flex;align-items:center;gap:10px;margin-bottom:6px}

    .serviceIcon{
      width:36px;height:36px;border-radius:10px;display:grid;place-items:center;
      background:rgba(255,255,255,.08);
      border:1px solid var(--stroke);
      font-size:18px;flex:0 0 auto;
    }

    .serviceCard h4{font-size:14.5px;font-weight:850;color:var(--textBright);letter-spacing:.2px}
    .serviceCard p{font-size:12px;color:var(--muted);line-height:1.4}

    .serviceBadge{
      position:absolute;right:10px;top:10px;
      font-size:9px;font-weight:900;padding:4px 8px;border-radius:999px;
      background:rgba(34,211,238,.2);
      color:var(--brand);
      border:1px solid rgba(34,211,238,.3);
      letter-spacing:.5px;
      user-select:none;
    }

    .costLine{
      margin-top:10px;
      display:flex;align-items:center;justify-content:space-between;gap:10px;
      font-size:11px;color:var(--muted);
      padding-top:10px;border-top:1px dashed rgba(255,255,255,.10);
    }
    .costLine strong{color:var(--textBright);font-weight:900}

    .main{flex:1 1 auto;display:flex;flex-direction:column;overflow:hidden;position:relative}

    .chatContainer{
      flex:1 1 auto;overflow-y:auto;padding:20px;
      display:flex;flex-direction:column;gap:16px;
    }

    .emptyState{
      flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;
      gap:18px;padding:40px 20px;text-align:center;
    }

    .emptyIcon{
      width:80px;height:80px;border-radius:20px;display:grid;place-items:center;
      background:var(--brandGrad);font-size:40px;
      box-shadow:0 20px 60px rgba(34,211,238,.25);
      animation:float 3s ease-in-out infinite;
    }

    @keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-10px)}}

    .emptyState h2{font-size:24px;font-weight:900;color:var(--textBright);letter-spacing:.3px}
    .emptyState p{font-size:14px;color:var(--muted);max-width:420px;line-height:1.6}

    .quickActions{display:flex;flex-wrap:wrap;gap:10px;justify-content:center;margin-top:10px}

    .quickBtn{
      padding:10px 16px;background:rgba(255,255,255,.08);
      border:1px solid var(--stroke);border-radius:12px;
      font-size:13px;font-weight:700;color:var(--text);
      transition:var(--transitionFast);
    }
    .quickBtn:hover{background:rgba(255,255,255,.12);border-color:var(--brand);transform:translateY(-2px)}

    .message{display:flex;gap:12px;align-items:flex-start;animation:messageIn .3s ease-out}
    @keyframes messageIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}

    .messageAvatar{
      width:36px;height:36px;border-radius:10px;display:grid;place-items:center;
      flex:0 0 auto;font-size:18px;background:rgba(255,255,255,.08);
      border:1px solid var(--stroke);
      user-select:none;
    }
    .message.user .messageAvatar{background:linear-gradient(135deg, rgba(168,85,247,.35), rgba(217,70,239,.35));border-color:rgba(168,85,247,.4)}
    .message.assistant .messageAvatar{background:var(--brandGrad)}

    .messageContent{flex:1;display:flex;flex-direction:column;gap:6px;min-width:0}
    .messageMeta{display:flex;align-items:center;gap:8px;font-size:12px}
    .messageName{font-weight:800;color:var(--textBright)}
    .messageTime{color:var(--muted);font-size:11px}

    .messageText{
      padding:14px 16px;background:rgba(255,255,255,.08);
      border:1px solid var(--stroke);
      border-radius:var(--radiusSm);
      line-height:1.6;font-size:13.5px;color:var(--text);
      white-space:pre-wrap;
      word-break:break-word;
    }
    .message.assistant .messageText{
      background:linear-gradient(135deg, rgba(34,211,238,.12), rgba(59,130,246,.08));
      border-color:rgba(34,211,238,.25);
    }

    .attachmentPills{
      display:flex;flex-wrap:wrap;gap:8px;margin-top:8px;
    }
    .pill{
      font-size:11px;font-weight:800;
      padding:6px 10px;border-radius:999px;
      background:rgba(255,255,255,.07);
      border:1px solid rgba(255,255,255,.12);
      color:var(--text);
      display:flex;align-items:center;gap:8px;
      max-width:100%;
    }
    .pill span{color:var(--muted);font-weight:900}
    .pill button{
      width:18px;height:18px;border-radius:50%;
      display:grid;place-items:center;
      background:rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.14);
      color:var(--muted);
      transition:var(--transitionFast);
    }
    .pill button:hover{background:rgba(239,68,68,.18);border-color:rgba(239,68,68,.35);color:#fecaca}

    .inputArea{
      flex:0 0 auto;padding:16px 20px;border-top:1px solid var(--stroke);
      background:rgba(255,255,255,.04);backdrop-filter:blur(12px);
    }

    .inputWrapper{display:flex;gap:10px;align-items:flex-end}

    .inputBox{
      flex:1;display:flex;flex-direction:column;gap:10px;
      padding:12px 14px;
      background:rgba(255,255,255,.08);
      border:1px solid var(--stroke);
      border-radius:var(--radiusSm);
      transition:var(--transition);
      min-width:0;
    }
    .inputBox:focus-within{border-color:var(--brand);background:rgba(255,255,255,.10);box-shadow:0 0 0 3px rgba(34,211,238,.15)}

    .inputTop{display:flex;gap:8px;align-items:center;flex-wrap:wrap}

    .serviceTag{
      padding:4px 10px;background:rgba(34,211,238,.18);
      border:1px solid rgba(34,211,238,.3);
      border-radius:8px;font-size:11px;font-weight:900;color:var(--brand);
      letter-spacing:.3px;display:flex;align-items:center;gap:6px;
      user-select:none;
    }
    .serviceTag .costMini{
      padding:2px 8px;border-radius:999px;
      background:rgba(255,255,255,.10);
      border:1px solid rgba(255,255,255,.14);
      color:var(--text);
      font-size:10px;font-weight:900;
    }
    .serviceTag button{
      background:none;color:inherit;padding:0;width:14px;height:14px;
      display:grid;place-items:center;border-radius:50%;font-size:10px;
      transition:var(--transitionFast);
    }
    .serviceTag button:hover{background:rgba(239,68,68,.25);color:var(--danger)}

    textarea{
      width:100%;border:none;background:transparent;color:var(--text);
      resize:none;outline:none;font-size:14px;line-height:1.5;min-height:24px;max-height:120px;
    }
    textarea::placeholder{color:var(--muted)}

    .inputActions{display:flex;gap:8px;align-items:center;justify-content:space-between}
    .leftActions{display:flex;gap:6px;align-items:center}
    .rightActions{display:flex;gap:10px;align-items:center}

    .hintMini{
      font-size:11px;color:var(--muted);
      display:flex;align-items:center;gap:8px;white-space:nowrap;
    }
    .hintMini strong{color:var(--textBright);font-weight:900}

    .iconBtn{
      width:32px;height:32px;display:grid;place-items:center;
      background:rgba(255,255,255,.08);
      border:1px solid var(--stroke);
      border-radius:10px;font-size:16px;
      transition:var(--transitionFast);flex:0 0 auto;
    }
    .iconBtn:hover{background:rgba(255,255,255,.12);border-color:var(--brand);transform:translateY(-1px)}
    .iconBtn:active{transform:translateY(0)}

    .sendBtn{
      padding:12px 18px;background:var(--brandGrad);
      border:none;border-radius:12px;color:#051018;
      font-weight:900;font-size:14px;display:flex;align-items:center;gap:6px;
      transition:var(--transition);
      box-shadow:0 12px 40px rgba(34,211,238,.25);
      flex:0 0 auto;
      white-space:nowrap;
    }
    .sendBtn:hover{transform:translateY(-2px);box-shadow:0 16px 50px rgba(34,211,238,.35)}
    .sendBtn:active{transform:translateY(0)}
    .sendBtn:disabled{opacity:.5;cursor:not-allowed;transform:none!important}

    .aiHelper{
      position:fixed;right:20px;bottom:20px;width:60px;height:60px;border-radius:50%;
      background:var(--brandGrad);
      box-shadow:0 20px 60px rgba(34,211,238,.35);
      display:grid;place-items:center;font-size:28px;cursor:pointer;
      transition:var(--transition);z-index:999;
      animation:pulse 2s ease-in-out infinite;
    }
    .aiHelper:hover{transform:scale(1.1) rotate(-10deg);box-shadow:0 24px 70px rgba(34,211,238,.45)}
    @keyframes pulse{0%,100%{box-shadow:0 20px 60px rgba(34,211,238,.35)}50%{box-shadow:0 20px 80px rgba(34,211,238,.55)}}

    .overlay{
      position:fixed;inset:0;background:rgba(0,0,0,.65);
      backdrop-filter:blur(10px);
      display:none;align-items:center;justify-content:center;padding:20px;
      z-index:1000;
      animation:fadeIn .25s ease-out;
    }
    @keyframes fadeIn{from{opacity:0}to{opacity:1}}
    .overlay.show{display:flex}

    .modal{
      width:min(760px,100%);max-height:85vh;overflow-y:auto;
      border-radius:var(--radius);
      border:1px solid var(--stroke);
      background:linear-gradient(135deg, rgba(255,255,255,.14), rgba(255,255,255,.08));
      box-shadow:0 36px 150px rgba(0,0,0,.70);
      backdrop-filter:blur(24px) saturate(180%);
      animation:modalSlideIn .35s cubic-bezier(.4,0,.2,1);
    }
    @keyframes modalSlideIn{from{opacity:0;transform:translateY(-30px) scale(.96)}to{opacity:1;transform:translateY(0) scale(1)}}

    .modalHead{
      display:flex;align-items:center;justify-content:space-between;gap:12px;
      padding:18px 20px;border-bottom:1px solid var(--stroke);
      background:rgba(255,255,255,.05);
      position:sticky;top:0;z-index:1;
    }

    .modalTitle{display:flex;align-items:center;gap:12px}
    .modalTitle strong{font-size:16px;font-weight:900;color:var(--textBright);letter-spacing:.3px}

    .closeBtn{
      width:36px;height:36px;display:grid;place-items:center;
      background:rgba(255,255,255,.08);border:1px solid var(--stroke);
      border-radius:10px;font-size:18px;font-weight:900;color:var(--text);
      transition:var(--transitionFast);
    }
    .closeBtn:hover{background:rgba(239,68,68,.18);border-color:rgba(239,68,68,.35);color:var(--danger);transform:rotate(90deg)}

    .modalBody{padding:20px}

    .hint{
      padding:12px 14px;background:rgba(34,211,238,.10);
      border-left:3px solid var(--brand);border-radius:8px;
      font-size:13px;color:var(--muted);line-height:1.5;margin-bottom:18px;
    }

    .formGrid{display:grid;grid-template-columns:1fr 1fr;gap:14px}
    .field{display:flex;flex-direction:column;gap:7px}

    label{font-size:12.5px;font-weight:800;color:var(--textBright);letter-spacing:.2px}

    input,select{
      width:100%;padding:12px 14px;background:rgba(255,255,255,.08);
      border:1px solid var(--stroke);border-radius:var(--radiusSm);
      color:var(--text);font-size:13.5px;outline:none;transition:var(--transition);
    }
    input:hover,select:hover{background:rgba(255,255,255,.11)}
    input:focus,select:focus{background:rgba(255,255,255,.10);border-color:var(--brand);box-shadow:0 0 0 3px rgba(34,211,238,.15)}
    .promptArea{min-height:120px;resize:vertical;line-height:1.6}
    .full{grid-column:1/-1}

    .templateList{display:flex;flex-direction:column;gap:10px;max-height:300px;overflow-y:auto}
    .templateItem{
      padding:12px 14px;background:rgba(255,255,255,.08);
      border:1px solid var(--stroke);border-radius:12px;
      cursor:pointer;transition:var(--transitionFast);
      display:flex;align-items:flex-start;gap:10px;
      outline:none;
    }
    .templateItem:hover,.templateItem:focus-visible{background:rgba(255,255,255,.12);border-color:var(--brand);transform:translateX(3px)}
    .templateItem strong{font-size:13px;color:var(--textBright);display:block;margin-bottom:4px}
    .templateItem p{font-size:12px;color:var(--muted);line-height:1.4}

    .btnRow{display:flex;gap:10px;justify-content:flex-end;margin-top:18px;flex-wrap:wrap}
    .btn{padding:12px 20px;border-radius:var(--radiusSm);font-weight:900;font-size:14px;transition:var(--transition);letter-spacing:.2px}

    .btnSecondary{
      background:rgba(255,255,255,.08);
      border:1px solid var(--stroke);color:var(--text);
    }
    .btnSecondary:hover{background:rgba(255,255,255,.12);border-color:var(--strokeHover);transform:translateY(-1px)}

    .btnDanger{
      background:rgba(239,68,68,.18);
      border:1px solid rgba(239,68,68,.35);
      color:#fecaca;
    }
    .btnDanger:hover{transform:translateY(-1px);background:rgba(239,68,68,.24)}

    .btnPrimary{
      background:var(--brandGrad);border:none;color:#051018;
      box-shadow:0 18px 60px rgba(34,211,238,.25);
    }
    .btnPrimary:hover{transform:translateY(-2px);box-shadow:0 22px 70px rgba(34,211,238,.35)}
    .btnPrimary:disabled{opacity:.5;cursor:not-allowed;transform:none!important}

    .historyList{
      display:flex;flex-direction:column;gap:10px;
      max-height:420px;overflow:auto;
    }
    .historyItem{
      padding:12px 14px;border-radius:12px;
      background:rgba(255,255,255,.07);
      border:1px solid rgba(255,255,255,.12);
      display:flex;gap:12px;align-items:flex-start;
    }
    .historyRole{
      width:34px;height:34px;border-radius:10px;display:grid;place-items:center;
      background:rgba(255,255,255,.08);
      border:1px solid rgba(255,255,255,.14);
      flex:0 0 auto;
      user-select:none;
    }
    .historyRole.user{background:linear-gradient(135deg, rgba(168,85,247,.35), rgba(217,70,239,.35));border-color:rgba(168,85,247,.35)}
    .historyRole.assistant{background:linear-gradient(135deg, rgba(34,211,238,.30), rgba(59,130,246,.24));border-color:rgba(34,211,238,.25)}
    .historyBody{flex:1;min-width:0}
    .historyMeta{display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:6px}
    .historyMeta strong{color:var(--textBright);font-weight:900;font-size:12px}
    .historyMeta span{color:var(--muted);font-size:11px}
    .historyText{color:var(--text);font-size:13px;line-height:1.55;white-space:pre-wrap;word-break:break-word}

    .toast{
      position:fixed;bottom:24px;left:50%;transform:translateX(-50%);
      padding:14px 20px;background:rgba(11,16,32,.95);
      border:1px solid var(--stroke);border-radius:var(--radiusSm);
      color:var(--text);font-size:13.5px;font-weight:700;
      box-shadow:0 24px 100px rgba(0,0,0,.65);
      backdrop-filter:blur(16px);
      display:none;z-index:1001;
      max-width:min(520px, calc(100% - 40px));
      text-align:center;
      animation:toastSlideUp .35s cubic-bezier(.4,0,.2,1);
    }
    @keyframes toastSlideUp{from{opacity:0;transform:translateX(-50%) translateY(30px)}to{opacity:1;transform:translateX(-50%) translateY(0)}}
    .toast.show{display:block}
    .toast.success{border-color:rgba(34,197,94,.45);background:rgba(34,197,94,.18);color:#86efac}
    .toast.error{border-color:rgba(239,68,68,.45);background:rgba(239,68,68,.18);color:#fecaca}
    .toast.warning{border-color:rgba(245,158,11,.45);background:rgba(245,158,11,.18);color:#fde68a}

    ::-webkit-scrollbar{width:8px;height:8px}
    ::-webkit-scrollbar-track{background:rgba(255,255,255,.03)}
    ::-webkit-scrollbar-thumb{background:rgba(255,255,255,.15);border-radius:4px}
    ::-webkit-scrollbar-thumb:hover{background:rgba(255,255,255,.25)}

    @media (max-width: 768px){
      .sidebar{flex:0 0 100%;order:2;border-right:none;border-top:1px solid var(--stroke);max-height:42vh}
      .main{order:1}
      .container{flex-direction:column}
      .formGrid{grid-template-columns:1fr}
      .aiHelper{width:52px;height:52px;font-size:24px;right:16px;bottom:16px}
      .hintMini{display:none}
      .headerRight{gap:8px}
    }

    @media (prefers-reduced-motion: reduce){
      *,*::before,*::after{animation-duration:.01ms!important;transition-duration:.01ms!important}
    }

    .sr-only{
      position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;
      clip:rect(0,0,0,0);white-space:nowrap;border-width:0;
    }

    .loading{position:relative;pointer-events:none;opacity:.7}
    .loading::after{
      content:'';position:absolute;top:50%;left:50%;
      width:16px;height:16px;margin:-8px 0 0 -8px;
      border:2px solid transparent;border-top-color:currentColor;border-radius:50%;
      animation:spin .7s linear infinite;
    }
    @keyframes spin{to{transform:rotate(360deg)}}
  </style>
</head>

<body>
  <div class="app">
    <header class="header">
      <div class="brand" role="button" tabindex="0" id="homeBtn" aria-label="Go to welcome">
        <div class="logo" aria-hidden="true">G</div>
        <div class="brandtext">
          <div class="title" id="t_title">Avatar G</div>
          <div class="subtitle" id="t_subtitle">AI Workspace</div>
        </div>
      </div>

      <div class="headerRight">
        <div class="creditBadge" id="creditBadge" title="Credits balance">
          <span id="t_creditsLabel">Credits:</span> <strong id="creditNum">100</strong>
        </div>

        <button class="miniBtn" id="historyBtn" type="button">History</button>

        <button class="miniBtn" id="resetCreditsBtn" type="button" title="Reset credits (demo)">Reset</button>

        <div class="selectWrap">
          <select class="select" id="lang" aria-label="Language">
            <option value="ka" selected>KA</option>
            <option value="en">EN</option>
          </select>
        </div>
      </div>
    </header>

    <div class="container">
      <aside class="sidebar" aria-label="Services sidebar">
        <div class="sidebarTitle">
          <span id="t_services">Services</span>
          <span class="activeChip" id="activeChip" style="display:none;">ACTIVE</span>
        </div>

        <div class="serviceCard" data-service="avatar" tabindex="0" role="button" aria-label="Avatar service">
          <div class="serviceBadge">NEW</div>
          <div class="serviceTop">
            <div class="serviceIcon">üßë‚Äçüé≠</div>
            <h4 id="s_avatar">Avatar</h4>
          </div>
          <p id="sd_avatar">·Éê·Éï·Éê·É¢·Éê·É†·Éò·É° ·É®·Éî·É•·Éõ·Éú·Éê AI-·Éò·Éó</p>
          <div class="costLine"><span id="t_cost">Cost</span> <strong id="c_avatar">20</strong></div>
        </div>

        <div class="serviceCard" data-service="image" tabindex="0" role="button" aria-label="Image service">
          <div class="serviceTop">
            <div class="serviceIcon">üñºÔ∏è</div>
            <h4 id="s_image">Image</h4>
          </div>
          <p id="sd_image">·É§·Éù·É¢·Éù ·Éí·Éî·Éú·Éî·É†·Éê·É™·Éò·Éê/·É†·Éî·Éì·Éê·É•·É¢·Éò·É†·Éî·Éë·Éê</p>
          <div class="costLine"><span id="t_cost2">Cost</span> <strong id="c_image">12</strong></div>
        </div>

        <div class="serviceCard" data-service="video" tabindex="0" role="button" aria-label="Video service">
          <div class="serviceBadge" style="background: rgba(168, 85, 247, .2); border-color: rgba(168, 85, 247, .3); color: #c084fc;">PRO</div>
          <div class="serviceTop">
            <div class="serviceIcon">üé¨</div>
            <h4 id="s_video">Video</h4>
          </div>
          <p id="sd_video">·Éï·Éò·Éì·Éî·Éù ·É°·É™·Éî·Éú·Éê·É†·Éò ·Éì·Éê ·É®·Éî·É•·Éõ·Éú·Éê</p>
          <div class="costLine"><span id="t_cost3">Cost</span> <strong id="c_video">25</strong></div>
        </div>

        <div class="serviceCard" data-service="voice" tabindex="0" role="button" aria-label="Voice service">
          <div class="serviceTop">
            <div class="serviceIcon">üé§</div>
            <h4 id="s_voice">Voice</h4>
          </div>
          <p id="sd_voice">·ÉÆ·Éõ·Éò·É° ·Éí·Éî·Éú·Éî·É†·Éê·É™·Éò·Éê ·Éì·Éê ·Éô·Éö·Éù·Éú·Éò·É†·Éî·Éë·Éê</p>
          <div class="costLine"><span id="t_cost4">Cost</span> <strong id="c_voice">18</strong></div>
        </div>

        <div class="serviceCard" data-service="music" tabindex="0" role="button" aria-label="Music service">
          <div class="serviceTop">
            <div class="serviceIcon">üéµ</div>
            <h4 id="s_music">Music</h4>
          </div>
          <p id="sd_music">·Éõ·É£·É°·Éò·Éô·Éò·É° ·É®·Éî·É•·Éõ·Éú·Éê AI-·Éò·Éó</p>
          <div class="costLine"><span id="t_cost5">Cost</span> <strong id="c_music">10</strong></div>
        </div>

        <div class="serviceCard" data-service="text" tabindex="0" role="button" aria-label="Text service">
          <div class="serviceTop">
            <div class="serviceIcon">‚úçÔ∏è</div>
            <h4 id="s_text">Text</h4>
          </div>
          <p id="sd_text">·É¢·Éî·É•·É°·É¢·Éò·É° ·Éí·Éî·Éú·Éî·É†·Éê·É™·Éò·Éê ·Éì·Éê ·É†·Éî·Éì·Éê·É•·É¢·Éò·É†·Éî·Éë·Éê</p>
          <div class="costLine"><span id="t_cost6">Cost</span> <strong id="c_text">6</strong></div>
        </div>
      </aside>

      <main class="main">
        <div class="chatContainer" id="chatContainer">
          <div class="emptyState" id="emptyState">
            <div class="emptyIcon">ü§ñ</div>
            <h2 id="t_welcome">·Éí·Éê·Éõ·Éê·É†·ÉØ·Éù·Éë·Éê! üëã</h2>
            <p id="t_welcomeText">
              ·Éõ·Éù·Éí·Éî·É°·Éê·Éö·Éõ·Éî·Éë·Éò·Éó Avatar G AI Workspace-·É®·Éò.<br/>
              ·Éê·Éò·É†·É©·Éò·Éî·Éó ·É°·Éî·É†·Éï·Éò·É°·Éò ·Éì·Éê ·Éì·Éê·Éò·É¨·Éß·Éî·Éó ·É®·Éî·É•·Éõ·Éú·Éê.
            </p>
            <div class="quickActions">
              <button class="quickBtn" data-quick="avatar" id="q_avatar">·É®·Éî·É•·Éõ·Éî·Éú·Éò ·Éê·Éï·Éê·É¢·Éê·É†·Éò</button>
              <button class="quickBtn" data-quick="video" id="q_video">·Éí·Éê·Éê·Éô·Éî·Éó·Éî ·Éï·Éò·Éì·Éî·Éù</button>
              <button class="quickBtn" data-quick="text" id="q_text">·Éì·Éê·É¨·Éî·É†·Éî ·É¢·Éî·É•·É°·É¢·Éò</button>
            </div>
          </div>
        </div>

        <div class="inputArea">
          <div class="inputWrapper">
            <div class="inputBox">
              <div class="inputTop" id="serviceTagContainer" style="display:none;">
                <div class="serviceTag" id="activeServiceTag">
                  <span id="tagServiceName">Service</span>
                  <span class="costMini" id="tagCost">‚Äî</span>
                  <button type="button" id="removeServiceTag" aria-label="Remove service">‚úï</button>
                </div>
              </div>

              <div class="attachmentPills" id="attachPills" style="display:none;"></div>

              <textarea id="mainInput" placeholder="·É†·Éê·É° ·É®·Éî·Éï·É•·Éõ·Éú·Éê·Éó ·Éì·É¶·Éî·É°? ·Éê·É¶·É¨·Éî·É†·Éî·Éó ·Éó·É•·Éï·Éî·Éú·Éò ·Éò·Éì·Éî·Éê..." rows="1"></textarea>

              <div class="inputActions">
                <div class="leftActions">
                  <button class="iconBtn" id="attachBtn" type="button" title="Attach" aria-label="Attach files">üìé</button>
                  <button class="iconBtn" id="promptBtn" type="button" title="Prompt Builder" aria-label="Open prompt builder">‚ú®</button>
                </div>
                <div class="rightActions">
                  <div class="hintMini" id="costPreview" style="display:none;">
                    <span id="t_costPreview">Cost:</span> <strong id="costPreviewNum">‚Äî</strong>
                  </div>
                </div>
              </div>
            </div>

            <button class="sendBtn" id="sendBtn" type="button">
              <span id="t_send">·Éí·Éê·Éí·Éñ·Éê·Éï·Éú·Éê</span>
              <span>‚Üí</span>
            </button>
          </div>

          <input id="fileInput" type="file" class="sr-only" multiple />
        </div>
      </main>
    </div>

    <button class="aiHelper" id="aiHelperBtn" type="button" aria-label="AI Helper" title="AI Assistant">ü§ñ</button>
  </div>

  <!-- Prompt Builder Modal -->
  <div class="overlay" id="promptOverlay" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-label="Prompt Builder">
      <div class="modalHead">
        <div class="modalTitle">
          <span style="font-size:24px;">‚ú®</span>
          <strong id="t_promptBuilder">Prompt Builder</strong>
        </div>
        <button class="closeBtn" id="promptCloseBtn" aria-label="Close">‚úï</button>
      </div>
      <div class="modalBody">
        <div class="hint" id="promptHint">·Éê·Éò·É†·É©·Éò·Éî·Éó template ·Éê·Éú ·É®·Éî·É•·Éõ·Éî·Éú·Éò·Éó custom prompt ·Éó·É•·Éï·Éî·Éú·Éò ·É°·Éî·É†·Éï·Éò·É°·Éò·É°·Éó·Éï·Éò·É°.</div>

        <div class="formGrid">
          <div class="field">
            <label id="l_service">Service</label>
            <select id="promptService">
              <option value="">‚Äî ·Éê·É†·É©·Éî·Éï·Éê ‚Äî</option>
              <option value="avatar">Avatar</option>
              <option value="image">Image</option>
              <option value="video">Video</option>
              <option value="voice">Voice</option>
              <option value="music">Music</option>
              <option value="text">Text</option>
            </select>
          </div>

          <div class="field">
            <label id="l_style">Style / Tone</label>
            <select id="promptStyle">
              <option value="">‚Äî ·Éê·É†·É©·Éî·Éï·Éê ‚Äî</option>
              <option value="professional">Professional</option>
              <option value="casual">Casual</option>
              <option value="creative">Creative</option>
              <option value="technical">Technical</option>
            </select>
          </div>

          <div class="field full">
            <label id="l_custom">Custom Prompt</label>
            <textarea id="customPrompt" class="promptArea" placeholder="·Éõ·Éê·Éí: Create a 15-second Instagram Reel with upbeat music..."></textarea>
          </div>
        </div>

        <div style="margin:18px 0;">
          <label style="margin-bottom:10px; display:block;" id="l_templates">Templates</label>
          <div class="templateList" id="templateList"></div>
        </div>

        <div class="btnRow">
          <button class="btn btnSecondary" id="promptCancelBtn">Cancel</button>
          <button class="btn btnPrimary" id="promptUseBtn">Use Prompt</button>
        </div>
      </div>
    </div>
  </div>

  <!-- AI Helper Modal -->
  <div class="overlay" id="helperOverlay" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-label="AI Helper">
      <div class="modalHead">
        <div class="modalTitle">
          <span style="font-size:24px;">ü§ñ</span>
          <strong id="t_aiHelper">AI Helper</strong>
        </div>
        <button class="closeBtn" id="helperCloseBtn" aria-label="Close">‚úï</button>
      </div>
      <div class="modalBody">
        <div class="hint" id="helperHint">·Éí·Éê·Éõ·Éê·É†·ÉØ·Éù·Éë·Éê! ·Éõ·Éî ·Éï·Éê·É† Avatar G-·Éò·É° AI ·Éê·É°·Éò·É°·É¢·Éî·Éú·É¢·Éò. ·Éí·Éî·ÉÆ·Éõ·Éê·É†·Éî·Éë·Éò·Éó ·Éò·Éì·Éî·Éî·Éë·Éò·É° ·Éí·Éî·Éú·Éî·É†·Éò·É†·Éî·Éë·Éê·É°·Éê ·Éì·Éê prompt-·Éî·Éë·Éò·É° ·É®·Éî·É•·Éõ·Éú·Éê·É®·Éò.</div>

        <div class="formGrid">
          <div class="field full">
            <label id="l_question">·É†·Éê·É®·Éò ·Éí·É≠·Éò·É†·Éì·Éî·Éë·Éê·Éó ·Éì·Éê·ÉÆ·Éõ·Éê·É†·Éî·Éë·Éê?</label>
            <textarea id="helperQuestion" class="promptArea" placeholder="·Éõ·Éê·Éí: ·É†·Éù·Éí·Éù·É† ·É®·Éî·Éï·É•·Éõ·Éú·Éê ·Éî·É§·Éî·É•·É¢·É£·É†·Éò Instagram Reel?"></textarea>
          </div>
        </div>

        <div class="btnRow">
          <button class="btn btnSecondary" id="helperCancelBtn">Close</button>
          <button class="btn btnPrimary" id="helperAskBtn">Ask AI</button>
        </div>

        <div id="helperResponse" style="margin-top:18px; display:none;">
          <label style="margin-bottom:10px; display:block; font-weight:800;">AI Response:</label>
          <div style="padding:14px; background: rgba(34, 211, 238, .10); border: 1px solid rgba(34, 211, 238, .25); border-radius: 12px; line-height: 1.6; font-size: 13.5px;">
            <div id="helperResponseText"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- History Modal -->
  <div class="overlay" id="historyOverlay" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-label="History">
      <div class="modalHead">
        <div class="modalTitle">
          <span style="font-size:24px;">üóÇÔ∏è</span>
          <strong id="t_history">History</strong>
        </div>
        <button class="closeBtn" id="historyCloseBtn" aria-label="Close">‚úï</button>
      </div>
      <div class="modalBody">
        <div class="hint" id="historyHint">·Éê·É• ·Éú·Éê·ÉÆ·Éê·Éï·Éó ·É©·Éê·É¢·Éò·É° ·Éò·É°·É¢·Éù·É†·Éò·Éê·É° (localStorage). ·É®·Éî·Éí·Éò·É´·Éö·Éò·Éê·Éó ·Éí·Éê·É°·É£·É§·Éó·Éê·Éï·Éî·Éë·Éê ·Éê·Éú ·Éî·É•·É°·Éû·Éù·É†·É¢·Éò.</div>

        <div class="btnRow" style="justify-content:flex-start; margin-top:0; margin-bottom:14px;">
          <button class="btn btnSecondary" id="exportBtn">Export JSON</button>
          <button class="btn btnDanger" id="clearBtn">Clear History</button>
        </div>

        <div class="historyList" id="historyList"></div>

        <div class="btnRow">
          <button class="btn btnSecondary" id="historyCancelBtn">Close</button>
        </div>
      </div>
    </div>
  </div>

  <div class="toast" id="toast" role="alert">Done</div>

  <script>
    // ===== Storage Keys =====
    const STORE_MESSAGES = "avatar_g_messages_v2";
    const STORE_CREDITS  = "avatar_g_credits_v2";
    const STORE_LANG     = "avatar_g_lang_v2";
    const STORE_SERVICE  = "avatar_g_active_service_v2";

    const CREDIT_DEFAULT = 100;
    const CREDIT_COST = { avatar: 20, image: 12, video: 25, voice: 18, music: 10, text: 6 };

    // ===== Helpers =====
    const safeJSONParse = (s, fallback) => { try { return JSON.parse(s); } catch { return fallback; } };

    function getCredits() {
      const v = Number(localStorage.getItem(STORE_CREDITS));
      return Number.isFinite(v) && v >= 0 ? v : CREDIT_DEFAULT;
    }
    function setCredits(v) {
      localStorage.setItem(STORE_CREDITS, String(Math.max(0, Math.floor(v))));
      updateCreditsDisplay();
    }
    function updateCreditsDisplay() {
      document.getElementById("creditNum").textContent = getCredits();
    }

    function initStorage() {
      if (!localStorage.getItem(STORE_MESSAGES)) localStorage.setItem(STORE_MESSAGES, JSON.stringify([]));
      if (!localStorage.getItem(STORE_CREDITS))  localStorage.setItem(STORE_CREDITS, String(CREDIT_DEFAULT));
      if (!localStorage.getItem(STORE_LANG))     localStorage.setItem(STORE_LANG, "ka");
      if (!localStorage.getItem(STORE_SERVICE))  localStorage.setItem(STORE_SERVICE, "");
    }

    // ===== i18n =====
    const I18N = {
      ka: {
        title: "Avatar G",
        subtitle: "AI Workspace",
        services: "·É°·Éî·É†·Éï·Éò·É°·Éî·Éë·Éò",
        cost: "Cost",
        creditsLabel: "Credits:",
        history: "History",
        historyHint: "·Éê·É• ·Éú·Éê·ÉÆ·Éê·Éï·Éó ·É©·Éê·É¢·Éò·É° ·Éò·É°·É¢·Éù·É†·Éò·Éê·É° (localStorage). ·É®·Éî·Éí·Éò·É´·Éö·Éò·Éê·Éó ·Éí·Éê·É°·É£·É§·Éó·Éê·Éï·Éî·Éë·Éê ·Éê·Éú ·Éî·É•·É°·Éû·Éù·É†·É¢·Éò.",
        export: "Export JSON",
        clear: "Clear History",
        reset: "Reset",
        s_avatar: "Avatar",
        sd_avatar: "·Éê·Éï·Éê·É¢·Éê·É†·Éò·É° ·É®·Éî·É•·Éõ·Éú·Éê AI-·Éò·Éó",
        s_image: "Image",
        sd_image: "·É§·Éù·É¢·Éù ·Éí·Éî·Éú·Éî·É†·Éê·É™·Éò·Éê/·É†·Éî·Éì·Éê·É•·É¢·Éò·É†·Éî·Éë·Éê",
        s_video: "Video",
        sd_video: "·Éï·Éò·Éì·Éî·Éù ·É°·É™·Éî·Éú·Éê·É†·Éò ·Éì·Éê ·É®·Éî·É•·Éõ·Éú·Éê",
        s_voice: "Voice",
        sd_voice: "·ÉÆ·Éõ·Éò·É° ·Éí·Éî·Éú·Éî·É†·Éê·É™·Éò·Éê ·Éì·Éê ·Éô·Éö·Éù·Éú·Éò·É†·Éî·Éë·Éê",
        s_music: "Music",
        sd_music: "·Éõ·É£·É°·Éò·Éô·Éò·É° ·É®·Éî·É•·Éõ·Éú·Éê AI-·Éò·Éó",
        s_text: "Text",
        sd_text: "·É¢·Éî·É•·É°·É¢·Éò·É° ·Éí·Éî·Éú·Éî·É†·Éê·É™·Éò·Éê ·Éì·Éê ·É†·Éî·Éì·Éê·É•·É¢·Éò·É†·Éî·Éë·Éê",
        welcome: "·Éí·Éê·Éõ·Éê·É†·ÉØ·Éù·Éë·Éê! üëã",
        welcomeText: "·Éõ·Éù·Éí·Éî·É°·Éê·Éö·Éõ·Éî·Éë·Éò·Éó Avatar G AI Workspace-·É®·Éò.<br/>·Éê·Éò·É†·É©·Éò·Éî·Éó ·É°·Éî·É†·Éï·Éò·É°·Éò ·Éì·Éê ·Éì·Éê·Éò·É¨·Éß·Éî·Éó ·É®·Éî·É•·Éõ·Éú·Éê.",
        q_avatar: "·É®·Éî·É•·Éõ·Éî·Éú·Éò ·Éê·Éï·Éê·É¢·Éê·É†·Éò",
        q_video: "·Éí·Éê·Éê·Éô·Éî·Éó·Éî ·Éï·Éò·Éì·Éî·Éù",
        q_text: "·Éì·Éê·É¨·Éî·É†·Éî ·É¢·Éî·É•·É°·É¢·Éò",
        send: "·Éí·Éê·Éí·Éñ·Éê·Éï·Éú·Éê",
        costPreview: "Cost:",
        promptBuilder: "Prompt Builder",
        promptHint: "·Éê·Éò·É†·É©·Éò·Éî·Éó template ·Éê·Éú ·É®·Éî·É•·Éõ·Éî·Éú·Éò·Éó custom prompt ·Éó·É•·Éï·Éî·Éú·Éò ·É°·Éî·É†·Éï·Éò·É°·Éò·É°·Éó·Éï·Éò·É°.",
        aiHelper: "AI Helper",
        helperHint: "·Éí·Éê·Éõ·Éê·É†·ÉØ·Éù·Éë·Éê! ·Éõ·Éî ·Éï·Éê·É† Avatar G-·Éò·É° AI ·Éê·É°·Éò·É°·É¢·Éî·Éú·É¢·Éò. ·Éí·Éî·ÉÆ·Éõ·Éê·É†·Éî·Éë·Éò·Éó ·Éò·Éì·Éî·Éî·Éë·Éò·É° ·Éí·Éî·Éú·Éî·É†·Éò·É†·Éî·Éë·Éê·É°·Éê ·Éì·Éê prompt-·Éî·Éë·Éò·É° ·É®·Éî·É•·Éõ·Éú·Éê·É®·Éò.",
        l_service: "Service",
        l_style: "Style / Tone",
        l_custom: "Custom Prompt",
        l_templates: "Templates",
        l_question: "·É†·Éê·É®·Éò ·Éí·É≠·Éò·É†·Éì·Éî·Éë·Éê·Éó ·Éì·Éê·ÉÆ·Éõ·Éê·É†·Éî·Éë·Éê?",
        inputPlaceholder: "·É†·Éê·É° ·É®·Éî·Éï·É•·Éõ·Éú·Éê·Éó ·Éì·É¶·Éî·É°? ·Éê·É¶·É¨·Éî·É†·Éî·Éó ·Éó·É•·Éï·Éî·Éú·Éò ·Éò·Éì·Éî·Éê...",
        assistantName: "Avatar G AI",
        userName: "·Éó·É•·Éï·Éî·Éú",
        pickServiceWarn: "‚ö†Ô∏è ·Éí·Éó·ÉÆ·Éù·Éï·Éó ·Éê·Éò·É†·É©·Éò·Éù·Éó ·É°·Éî·É†·Éï·Éò·É°·Éò",
        notEnoughCredits: "‚ö†Ô∏è ·Éê·É† ·Éí·Éê·É•·Éï·Éó ·É°·Éê·Éô·Éõ·Éê·É†·Éò·É°·Éò ·Éô·É†·Éî·Éì·Éò·É¢·Éî·Éë·Éò",
        promptEmpty: "‚ö†Ô∏è ·É®·Éî·Éò·Éß·Éï·Éê·Éú·Éî·Éó prompt",
        promptAdded: "‚úÖ Prompt ·Éì·Éê·Éî·Éõ·Éê·É¢·Éê",
        active: "ACTIVE",
        attached: "Attached",
        serviceActive: (s)=>`‚úÖ ${String(s).toUpperCase()} ·Éê·É•·É¢·Éò·É£·É†·Éò·Éê`,
        created: (c)=>`‚úÖ ·É®·Éî·É•·Éõ·Éú·Éò·Éö·Éò·Éê! Credits: ${c}`,
        historyEmpty: "·Éò·É°·É¢·Éù·É†·Éò·Éê ·É™·Éê·É†·Éò·Éî·Éö·Éò·Éê."
      },
      en: {
        title: "Avatar G",
        subtitle: "AI Workspace",
        services: "Services",
        cost: "Cost",
        creditsLabel: "Credits:",
        history: "History",
        historyHint: "Here is your chat history (localStorage). You can clear it or export.",
        export: "Export JSON",
        clear: "Clear History",
        reset: "Reset",
        s_avatar: "Avatar",
        sd_avatar: "Create AI avatars",
        s_image: "Image",
        sd_image: "Generate & edit images",
        s_video: "Video",
        sd_video: "Video scripts & creation",
        s_voice: "Voice",
        sd_voice: "Voice generation & cloning",
        s_music: "Music",
        sd_music: "AI music creation",
        s_text: "Text",
        sd_text: "Text generation & editing",
        welcome: "Hello! üëã",
        welcomeText: "Welcome to Avatar G AI Workspace.<br/>Choose a service and start creating.",
        q_avatar: "Create Avatar",
        q_video: "Make Video",
        q_text: "Write Text",
        send: "Send",
        costPreview: "Cost:",
        promptBuilder: "Prompt Builder",
        promptHint: "Choose a template or create a custom prompt for your service.",
        aiHelper: "AI Helper",
        helperHint: "Hi! I'm Avatar G's AI assistant. I can help you with ideas and prompt creation.",
        l_service: "Service",
        l_style: "Style / Tone",
        l_custom: "Custom Prompt",
        l_templates: "Templates",
        l_question: "What do you need help with?",
        inputPlaceholder: "What shall we create today? Describe your idea...",
        assistantName: "Avatar G AI",
        userName: "You",
        pickServiceWarn: "‚ö†Ô∏è Please select a service",
        notEnoughCredits: "‚ö†Ô∏è Not enough credits",
        promptEmpty: "‚ö†Ô∏è Enter a prompt",
        promptAdded: "‚úÖ Prompt added",
        active: "ACTIVE",
        attached: "Attached",
        serviceActive: (s)=>`‚úÖ ${String(s).toUpperCase()} active`,
        created: (c)=>`‚úÖ Done! Credits: ${c}`,
        historyEmpty: "History is empty."
      }
    };

    // ===== Templates =====
    const TEMPLATES = {
      avatar: [
        { name: "Professional Avatar", prompt: "Create a professional talking avatar for business presentation, neutral background, formal attire" },
        { name: "Social Media Avatar", prompt: "Casual talking avatar for Instagram/TikTok, trendy background, energetic vibe" },
        { name: "Product Demo Avatar", prompt: "Avatar presenting a product, enthusiastic tone, demonstration style" }
      ],
      image: [
        { name: "Social Post", prompt: "Create an eye-catching social media image, vibrant colors, modern design" },
        { name: "Product Photo", prompt: "Professional product photography, clean background, studio lighting" },
        { name: "Banner Design", prompt: "Web banner design, brand colors, call-to-action focus" }
      ],
      video: [
        { name: "Instagram Reel", prompt: "15-second Instagram Reel, fast-paced, trending music, attention-grabbing" },
        { name: "Tutorial Video", prompt: "Step-by-step tutorial video, clear instructions, educational tone" },
        { name: "Promo Video", prompt: "30-second promotional video, highlight key features, persuasive messaging" }
      ],
      voice: [
        { name: "Voiceover - Professional", prompt: "Professional voiceover, clear articulation, authoritative tone" },
        { name: "Voiceover - Friendly", prompt: "Warm and friendly voiceover, conversational style, approachable tone" },
        { name: "Narration", prompt: "Documentary-style narration, engaging storytelling, measured pace" }
      ],
      music: [
        { name: "Upbeat Background", prompt: "Upbeat background music, energetic, positive vibes, instrumental" },
        { name: "Calm Ambient", prompt: "Calm ambient music, relaxing atmosphere, subtle melody" },
        { name: "Corporate", prompt: "Corporate background music, professional, motivating, modern" }
      ],
      text: [
        { name: "Social Caption", prompt: "Engaging social media caption, emoji usage, call-to-action, hashtags" },
        { name: "Email Copy", prompt: "Professional email copy, clear structure, persuasive content" },
        { name: "Ad Copy", prompt: "Attention-grabbing ad copy, benefits-focused, strong CTA" }
      ]
    };

    // ===== State =====
    let currentLang = "ka";
    let activeService = null;
    let messages = [];
    let attachments = []; // {name, size}

    // ===== UI Elements =====
    const langSel = document.getElementById("lang");
    const chatContainer = document.getElementById("chatContainer");
    const emptyState = document.getElementById("emptyState");
    const mainInput = document.getElementById("mainInput");
    const sendBtn = document.getElementById("sendBtn");

    const serviceTagContainer = document.getElementById("serviceTagContainer");
    const tagServiceName = document.getElementById("tagServiceName");
    const tagCost = document.getElementById("tagCost");
    const removeServiceTag = document.getElementById("removeServiceTag");

    const costPreview = document.getElementById("costPreview");
    const costPreviewNum = document.getElementById("costPreviewNum");

    const attachBtn = document.getElementById("attachBtn");
    const fileInput = document.getElementById("fileInput");
    const attachPills = document.getElementById("attachPills");

    const promptOverlay = document.getElementById("promptOverlay");
    const promptBtn = document.getElementById("promptBtn");
    const promptCloseBtn = document.getElementById("promptCloseBtn");
    const promptCancelBtn = document.getElementById("promptCancelBtn");
    const promptUseBtn = document.getElementById("promptUseBtn");
    const promptService = document.getElementById("promptService");
    const promptStyle = document.getElementById("promptStyle");
    const customPrompt = document.getElementById("customPrompt");
    const templateList = document.getElementById("templateList");

    const helperOverlay = document.getElementById("helperOverlay");
    const aiHelperBtn = document.getElementById("aiHelperBtn");
    const helperCloseBtn = document.getElementById("helperCloseBtn");
    const helperCancelBtn = document.getElementById("helperCancelBtn");
    const helperAskBtn = document.getElementById("helperAskBtn");
    const helperQuestion = document.getElementById("helperQuestion");
    const helperResponse = document.getElementById("helperResponse");
    const helperResponseText = document.getElementById("helperResponseText");

    const historyBtn = document.getElementById("historyBtn");
    const historyOverlay = document.getElementById("historyOverlay");
    const historyCloseBtn = document.getElementById("historyCloseBtn");
    const historyCancelBtn = document.getElementById("historyCancelBtn");
    const historyList = document.getElementById("historyList");
    const exportBtn = document.getElementById("exportBtn");
    const clearBtn = document.getElementById("clearBtn");

    const homeBtn = document.getElementById("homeBtn");
    const activeChip = document.getElementById("activeChip");

    const resetCreditsBtn = document.getElementById("resetCreditsBtn");
    const toast = document.getElementById("toast");

    // ===== Functions =====
    function tr() { return I18N[currentLang] || I18N.ka; }

    function applyLang(code) {
      currentLang = code;
      localStorage.setItem(STORE_LANG, code);
      const t = tr();

      document.getElementById("t_title").textContent = t.title;
      document.getElementById("t_subtitle").textContent = t.subtitle;

      document.getElementById("t_services").textContent = t.services;
      document.getElementById("t_cost").textContent = t.cost;
      document.getElementById("t_cost2").textContent = t.cost;
      document.getElementById("t_cost3").textContent = t.cost;
      document.getElementById("t_cost4").textContent = t.cost;
      document.getElementById("t_cost5").textContent = t.cost;
      document.getElementById("t_cost6").textContent = t.cost;

      document.getElementById("t_creditsLabel").textContent = t.creditsLabel;

      document.getElementById("historyBtn").textContent = t.history;
      document.getElementById("resetCreditsBtn").textContent = t.reset;

      document.getElementById("s_avatar").textContent = t.s_avatar;
      document.getElementById("sd_avatar").textContent = t.sd_avatar;
      document.getElementById("s_image").textContent = t.s_image;
      document.getElementById("sd_image").textContent = t.sd_image;
      document.getElementById("s_video").textContent = t.s_video;
      document.getElementById("sd_video").textContent = t.sd_video;
      document.getElementById("s_voice").textContent = t.s_voice;
      document.getElementById("sd_voice").textContent = t.sd_voice;
      document.getElementById("s_music").textContent = t.s_music;
      document.getElementById("sd_music").textContent = t.sd_music;
      document.getElementById("s_text").textContent = t.s_text;
      document.getElementById("sd_text").textContent = t.sd_text;

      document.getElementById("t_welcome").textContent = t.welcome;
      document.getElementById("t_welcomeText").innerHTML = t.welcomeText;
      document.getElementById("q_avatar").textContent = t.q_avatar;
      document.getElementById("q_video").textContent = t.q_video;
      document.getElementById("q_text").textContent = t.q_text;

      document.getElementById("t_send").textContent = t.send;
      document.getElementById("t_costPreview").textContent = t.costPreview;

      mainInput.placeholder = t.inputPlaceholder;

      document.getElementById("t_promptBuilder").textContent = t.promptBuilder;
      document.getElementById("promptHint").textContent = t.promptHint;

      document.getElementById("t_aiHelper").textContent = t.aiHelper;
      document.getElementById("helperHint").textContent = t.helperHint;

      document.getElementById("l_service").textContent = t.l_service;
      document.getElementById("l_style").textContent = t.l_style;
      document.getElementById("l_custom").textContent = t.l_custom;
      document.getElementById("l_templates").textContent = t.l_templates;
      document.getElementById("l_question").textContent = t.l_question;

      document.getElementById("t_history").textContent = t.history;
      document.getElementById("historyHint").textContent = t.historyHint;
      exportBtn.textContent = t.export;
      clearBtn.textContent = t.clear;
      historyCancelBtn.textContent = "Close";

      activeChip.textContent = t.active;

      // re-render messages labels in history list if open
      if (historyOverlay.classList.contains("show")) renderHistory();
      // re-render existing chat meta names if needed
      rerenderChatFromState(false);
      refreshCostUI();
    }

    function refreshCostUI() {
      if (!activeService) {
        costPreview.style.display = "none";
        activeChip.style.display = "none";
        return;
      }
      const cost = CREDIT_COST[activeService] || 0;
      costPreview.style.display = "flex";
      costPreviewNum.textContent = cost;
      activeChip.style.display = "inline-flex";
    }

    function setActiveService(service) {
      activeService = service || null;
      localStorage.setItem(STORE_SERVICE, activeService || "");

      // sidebar active state
      document.querySelectorAll(".serviceCard").forEach(card => {
        card.classList.toggle("active", card.dataset.service === activeService);
      });

      if (activeService) {
        const cost = CREDIT_COST[activeService] || 0;
        serviceTagContainer.style.display = "flex";
        tagServiceName.textContent = String(activeService).toUpperCase();
        tagCost.textContent = `${cost}`;
        refreshCostUI();
        mainInput.focus();
      } else {
        serviceTagContainer.style.display = "none";
        attachments = [];
        renderAttachments();
        refreshCostUI();
      }
    }

    function formatBytes(bytes) {
      if (!Number.isFinite(bytes) || bytes <= 0) return "0 B";
      const units = ["B","KB","MB","GB"];
      let i = 0, v = bytes;
      while (v >= 1024 && i < units.length-1) { v /= 1024; i++; }
      return `${v.toFixed(v >= 10 || i===0 ? 0 : 1)} ${units[i]}`;
    }

    function renderAttachments() {
      if (!attachments.length) {
        attachPills.style.display = "none";
        attachPills.innerHTML = "";
        return;
      }
      attachPills.style.display = "flex";
      attachPills.innerHTML = "";
      attachments.forEach((a, idx) => {
        const pill = document.createElement("div");
        pill.className = "pill";
        const name = document.createElement("div");
        name.style.overflow = "hidden";
        name.style.textOverflow = "ellipsis";
        name.style.whiteSpace = "nowrap";
        name.textContent = a.name;

        const size = document.createElement("span");
        size.textContent = formatBytes(a.size);

        const x = document.createElement("button");
        x.type = "button";
        x.setAttribute("aria-label", "Remove attachment");
        x.textContent = "‚úï";
        x.addEventListener("click", () => {
          attachments.splice(idx, 1);
          renderAttachments();
        });

        pill.appendChild(name);
        pill.appendChild(size);
        pill.appendChild(x);
        attachPills.appendChild(pill);
      });
    }

    function addMessage(role, content, files = []) {
      const msg = {
        role,
        content,
        files: (files || []).map(f => ({ name: f.name, size: f.size })),
        timestamp: new Date().toISOString()
      };
      messages.push(msg);
      localStorage.setItem(STORE_MESSAGES, JSON.stringify(messages));
      renderMessageToDOM(msg);
      chatContainer.scrollTop = chatContainer.scrollHeight;
    }

    function renderMessageToDOM(msg) {
      const t = tr();
      const messageEl = document.createElement("div");
      messageEl.className = `message ${msg.role}`;

      const avatar = document.createElement("div");
      avatar.className = "messageAvatar";
      avatar.textContent = msg.role === "user" ? "üë§" : "ü§ñ";

      const contentDiv = document.createElement("div");
      contentDiv.className = "messageContent";

      const meta = document.createElement("div");
      meta.className = "messageMeta";

      const name = document.createElement("span");
      name.className = "messageName";
      name.textContent = msg.role === "user" ? t.userName : t.assistantName;

      const time = document.createElement("span");
      time.className = "messageTime";
      time.textContent = new Date(msg.timestamp).toLocaleTimeString();

      meta.appendChild(name);
      meta.appendChild(time);

      const text = document.createElement("div");
      text.className = "messageText";
      text.textContent = msg.content;

      contentDiv.appendChild(meta);
      contentDiv.appendChild(text);

      if (msg.files && msg.files.length) {
        const list = document.createElement("div");
        list.className = "attachmentPills";
        msg.files.forEach(f => {
          const pill = document.createElement("div");
          pill.className = "pill";
          const fn = document.createElement("div");
          fn.style.overflow = "hidden";
          fn.style.textOverflow = "ellipsis";
          fn.style.whiteSpace = "nowrap";
          fn.textContent = f.name;
          const fs = document.createElement("span");
          fs.textContent = formatBytes(f.size);
          pill.appendChild(fn);
          pill.appendChild(fs);
          list.appendChild(pill);
        });
        contentDiv.appendChild(list);
      }

      messageEl.appendChild(avatar);
      messageEl.appendChild(contentDiv);

      if (emptyState.style.display !== "none") emptyState.style.display = "none";
      chatContainer.appendChild(messageEl);
    }

    function rerenderChatFromState(scrollToBottom = true) {
      // Keep empty state if no messages
      chatContainer.innerHTML = "";
      chatContainer.appendChild(emptyState);
      if (!messages.length) {
        emptyState.style.display = "";
        return;
      }
      emptyState.style.display = "none";
      messages.forEach(m => renderMessageToDOM(m));
      if (scrollToBottom) chatContainer.scrollTop = chatContainer.scrollHeight;
    }

    function generateAIResponse(service, userText) {
      const t = tr();
      const responses = {
        avatar: `${t.assistantName}: ${currentLang === "ka" ? "·É®·Éî·É•·Éõ·Éú·Éò·É° ·Éê·Éï·Éê·É¢·Éê·É†·É° ·É®·Éî·Éú·Éò ·Éõ·Éù·Éó·ÉÆ·Éù·Éï·Éú·Éò·Éó" : "Will create an avatar for your request"}: "${userText}".`,
        image: `${t.assistantName}: ${currentLang === "ka" ? "·Éê·Éõ·Éñ·Éê·Éì·Éî·Éë·É° ·É§·Éù·É¢·Éù·É°" : "Preparing an image"}: "${userText}".`,
        video: `${t.assistantName}: ${currentLang === "ka" ? "·É•·Éõ·Éú·Éò·É° ·Éï·Éò·Éì·Éî·Éù·É° ·Éó·É•·Éï·Éî·Éú·Éò ·Éò·Éì·Éî·Éò·Éó" : "Creating a video from your idea"}: "${userText}".`,
        voice: `${t.assistantName}: ${currentLang === "ka" ? "·Éí·Éî·Éú·Éî·É†·Éò·É†·Éî·Éë·É° ·ÉÆ·Éõ·Éê·É°" : "Generating voice"}: "${userText}".`,
        music: `${t.assistantName}: ${currentLang === "ka" ? "·É•·Éõ·Éú·Éò·É° ·Éõ·É£·É°·Éò·Éô·Éê·É°" : "Creating music"}: "${userText}".`,
        text: `${t.assistantName}: ${currentLang === "ka" ? "·É¨·Éî·É†·É° ·É¢·Éî·É•·É°·É¢·É°" : "Writing text"}: "${userText}".`
      };
      return responses[service] || `${t.assistantName} is working on your request.`;
    }

    function handleSend() {
      const text = mainInput.value.trim();
      if (!text) return;

      const t = tr();

      if (!activeService) {
        toastMsg(t.pickServiceWarn, "warning");
        return;
      }

      const credits = getCredits();
      const cost = CREDIT_COST[activeService] || 0;
      if (credits < cost) {
        toastMsg(t.notEnoughCredits, "warning");
        return;
      }

      const filesToAttach = attachments.slice();
      addMessage("user", text, filesToAttach);

      // reset input + attachments
      mainInput.value = "";
      mainInput.style.height = "auto";
      attachments = [];
      renderAttachments();

      sendBtn.disabled = true;
      sendBtn.classList.add("loading");

      setTimeout(() => {
        const response = generateAIResponse(activeService, text);
        addMessage("assistant", response);
        setCredits(credits - cost);
        sendBtn.disabled = false;
        sendBtn.classList.remove("loading");
        toastMsg(t.created(getCredits()), "success");
      }, 900);
    }

    // ===== Prompt Builder =====
    function openPromptBuilder() {
      promptOverlay.classList.add("show");
      promptOverlay.setAttribute("aria-hidden","false");
      if (activeService) {
        promptService.value = activeService;
        renderTemplates(activeService);
      } else {
        renderTemplates(promptService.value);
      }
      setTimeout(() => customPrompt.focus(), 60);
    }
    function closePromptBuilder() {
      promptOverlay.classList.remove("show");
      promptOverlay.setAttribute("aria-hidden","true");
    }
    function renderTemplates(service) {
      templateList.innerHTML = "";
      if (!service || !TEMPLATES[service]) return;

      TEMPLATES[service].forEach(tpl => {
        const item = document.createElement("button");
        item.type = "button";
        item.className = "templateItem";
        item.innerHTML = `
          <div style="flex:1; text-align:left;">
            <strong></strong>
            <p></p>
          </div>
        `;
        item.querySelector("strong").textContent = tpl.name;
        item.querySelector("p").textContent = tpl.prompt;
        item.addEventListener("click", () => { customPrompt.value = tpl.prompt; });
        templateList.appendChild(item);
      });
    }

    function usePrompt() {
      const t = tr();
      const prompt = customPrompt.value.trim();
      if (!prompt) {
        toastMsg(t.promptEmpty, "warning");
        return;
      }

      // Optional style prefix
      const style = promptStyle.value;
      const styled =
        style
          ? `Style/Tone: ${style}\n\n${prompt}`
          : prompt;

      mainInput.value = styled;

      if (promptService.value) setActiveService(promptService.value);

      closePromptBuilder();
      toastMsg(t.promptAdded, "success");
      mainInput.focus();
    }

    // ===== AI Helper =====
    function openHelper() {
      helperOverlay.classList.add("show");
      helperOverlay.setAttribute("aria-hidden","false");
      helperResponse.style.display = "none";
      helperQuestion.value = "";
      setTimeout(() => helperQuestion.focus(), 60);
    }
    function closeHelper() {
      helperOverlay.classList.remove("show");
      helperOverlay.setAttribute("aria-hidden","true");
    }
    function askHelper() {
      const question = helperQuestion.value.trim();
      const t = tr();
      if (!question) {
        toastMsg(t.promptEmpty, "warning");
        return;
      }

      helperAskBtn.classList.add("loading");
      helperAskBtn.disabled = true;

      setTimeout(() => {
        const answer =
          currentLang === "ka"
            ? `·Éõ·Éê·Éì·Éö·Éù·Éë·Éê ·Éô·Éò·Éó·ÉÆ·Éï·Éò·É°·Éó·Éï·Éò·É°! "${question}"\n\n·É°·É¨·É†·Éê·É§·Éò ·É©·Éî·Éô·Éö·Éò·É°·É¢·Éò:\n1) ·Éõ·Éò·Éñ·Éê·Éú·Éò + ·Éê·É£·Éì·Éò·É¢·Éù·É†·Éò·Éê\n2) ·É†·Éê ·É®·Éî·Éì·Éî·Éí·Éò ·Éí·Éò·Éú·Éì·Éê (·É§·Éù·É†·Éõ·Éê·É¢·Éò/·É°·Éò·Éí·É†·É´·Éî)\n3) Style/Tone (Professional/Casual/Creative/Technical)\n4) Constraints (·Éî·Éú·Éê, ·Éì·É†·Éù, ·Éû·Éö·Éê·É¢·É§·Éù·É†·Éõ·Éê)\n5) Reference (·Éõ·Éê·Éí·Éê·Éö·Éò·Éó·Éò/·Éë·É†·Éî·Éú·Éì·Éò)\n\n·Éê·ÉÆ·Éö·Éê ·Éí·Éê·ÉÆ·É°·Éî·Éú·Éò Prompt Builder ‚ú® ·Éì·Éê ·Éê·Éò·É†·É©·Éò·Éî template ‚Äî ·É®·Éî·Éõ·Éì·Éî·Éí ·Éì·Éê·Éï·ÉÆ·Éï·Éî·É¨·Éù·Éó ·Éî·É†·Éó·Éê·Éì.`
            : `Thanks! "${question}"\n\nQuick checklist:\n1) Goal + audience\n2) Desired output (format/length)\n3) Style/Tone\n4) Constraints (language, platform)\n5) Reference\n\nOpen Prompt Builder ‚ú®, pick a template, then we refine together.`;

        helperResponseText.textContent = answer;
        helperResponse.style.display = "block";
        helperAskBtn.classList.remove("loading");
        helperAskBtn.disabled = false;
      }, 850);
    }

    // ===== History =====
    function openHistory() {
      historyOverlay.classList.add("show");
      historyOverlay.setAttribute("aria-hidden","false");
      renderHistory();
    }
    function closeHistory() {
      historyOverlay.classList.remove("show");
      historyOverlay.setAttribute("aria-hidden","true");
    }
    function renderHistory() {
      const t = tr();
      historyList.innerHTML = "";
      if (!messages.length) {
        const div = document.createElement("div");
        div.className = "hint";
        div.textContent = t.historyEmpty;
        historyList.appendChild(div);
        return;
      }

      messages.slice().reverse().forEach(m => {
        const item = document.createElement("div");
        item.className = "historyItem";

        const role = document.createElement("div");
        role.className = `historyRole ${m.role}`;
        role.textContent = m.role === "user" ? "üë§" : "ü§ñ";

        const body = document.createElement("div");
        body.className = "historyBody";

        const meta = document.createElement("div");
        meta.className = "historyMeta";

        const who = document.createElement("strong");
        who.textContent = m.role === "user" ? t.userName : t.assistantName;

        const when = document.createElement("span");
        when.textContent = new Date(m.timestamp).toLocaleString();

        meta.appendChild(who);
        meta.appendChild(when);

        const text = document.createElement("div");
        text.className = "historyText";
        text.textContent = m.content;

        body.appendChild(meta);
        body.appendChild(text);

        if (m.files && m.files.length) {
          const filesLine = document.createElement("div");
          filesLine.style.marginTop = "10px";
          filesLine.style.color = "var(--muted)";
          filesLine.style.fontSize = "12px";
          filesLine.textContent = `${t.attached}: ${m.files.map(f => f.name).join(", ")}`;
          body.appendChild(filesLine);
        }

        item.appendChild(role);
        item.appendChild(body);
        historyList.appendChild(item);
      });
    }

    function exportHistory() {
      const blob = new Blob([JSON.stringify({ messages, credits: getCredits(), lang: currentLang }, null, 2)], { type: "application/json" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "avatar-g-history.json";
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
      toastMsg("‚úÖ Exported", "success");
    }

    function clearHistory() {
      localStorage.setItem(STORE_MESSAGES, JSON.stringify([]));
      messages = [];
      rerenderChatFromState();
      renderHistory();
      toastMsg("‚úÖ Cleared", "success");
    }

    // ===== Toast =====
    function toastMsg(msg, type="") {
      toast.textContent = msg;
      toast.className = "toast show";
      if (type) toast.classList.add(type);
      setTimeout(() => {
        toast.classList.remove("show");
        setTimeout(() => toast.className = "toast", 250);
      }, 2600);
    }

    // ===== Events =====
    langSel.addEventListener("change", (e) => applyLang(e.target.value));

    document.querySelectorAll(".serviceCard").forEach(card => {
      const activate = () => {
        const service = card.dataset.service;
        setActiveService(service);
        toastMsg(tr().serviceActive(service), "success");
      };
      card.addEventListener("click", activate);
      card.addEventListener("keydown", (e) => {
        if (e.key === "Enter" || e.key === " ") { e.preventDefault(); activate(); }
      });
    });

    document.querySelectorAll("[data-quick]").forEach(btn => {
      btn.addEventListener("click", () => {
        const service = btn.dataset.quick;
        setActiveService(service);
        mainInput.focus();
      });
    });

    removeServiceTag.addEventListener("click", () => setActiveService(null));

    sendBtn.addEventListener("click", handleSend);
    mainInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        handleSend();
      }
    });

    mainInput.addEventListener("input", function(){
      this.style.height = "auto";
      this.style.height = Math.min(this.scrollHeight, 120) + "px";
    });

    // Attachments
    attachBtn.addEventListener("click", () => fileInput.click());
    fileInput.addEventListener("change", () => {
      const files = Array.from(fileInput.files || []);
      if (!files.length) return;
      const maxFiles = 6;
      attachments = attachments.concat(files.slice(0, maxFiles - attachments.length)).map(f => ({ name: f.name, size: f.size }));
      renderAttachments();
      fileInput.value = "";
      toastMsg("‚úÖ Attached", "success");
    });

    // Prompt builder
    promptBtn.addEventListener("click", openPromptBuilder);
    promptCloseBtn.addEventListener("click", closePromptBuilder);
    promptCancelBtn.addEventListener("click", closePromptBuilder);
    promptUseBtn.addEventListener("click", usePrompt);
    promptService.addEventListener("change", (e) => renderTemplates(e.target.value));

    // Helper
    aiHelperBtn.addEventListener("click", openHelper);
    helperCloseBtn.addEventListener("click", closeHelper);
    helperCancelBtn.addEventListener("click", closeHelper);
    helperAskBtn.addEventListener("click", askHelper);

    // History
    historyBtn.addEventListener("click", openHistory);
    historyCloseBtn.addEventListener("click", closeHistory);
    historyCancelBtn.addEventListener("click", closeHistory);
    exportBtn.addEventListener("click", exportHistory);
    clearBtn.addEventListener("click", clearHistory);

    // Home (welcome scroll + clear service)
    function goHome() {
      setActiveService(null);
      if (!messages.length) {
        emptyState.style.display = "";
        chatContainer.scrollTop = 0;
      } else {
        chatContainer.scrollTop = 0;
      }
      toastMsg("‚úÖ Home", "success");
    }
    homeBtn.addEventListener("click", goHome);
    homeBtn.addEventListener("keydown", (e) => {
      if (e.key === "Enter" || e.key === " ") { e.preventDefault(); goHome(); }
    });

    // Reset credits (demo)
    resetCreditsBtn.addEventListener("click", () => {
      setCredits(CREDIT_DEFAULT);
      toastMsg("‚úÖ Credits reset", "success");
    });

    // Overlay click-to-close
    [promptOverlay, helperOverlay, historyOverlay].forEach(ov => {
      ov.addEventListener("click", (e) => { if (e.target === ov) ov.classList.contains("show") && (ov === promptOverlay ? closePromptBuilder() : ov === helperOverlay ? closeHelper() : closeHistory()); });
    });

    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape") {
        if (promptOverlay.classList.contains("show")) closePromptBuilder();
        if (helperOverlay.classList.contains("show")) closeHelper();
        if (historyOverlay.classList.contains("show")) closeHistory();
      }
    });

    // ===== Init =====
    initStorage();

    // Load persisted lang/service/messages
    currentLang = localStorage.getItem(STORE_LANG) || "ka";
    langSel.value = currentLang;
    applyLang(currentLang);

    updateCreditsDisplay();

    messages = safeJSONParse(localStorage.getItem(STORE_MESSAGES) || "[]", []);
    rerenderChatFromState();

    const persistedService = (localStorage.getItem(STORE_SERVICE) || "").trim();
    if (persistedService) setActiveService(persistedService);

    // Console brand
    console.log("%cüöÄ Avatar G AI Workspace", "font-size:20px;font-weight:900;color:#22d3ee;");
    console.log("%c‚ú® Ready to create!", "font-size:14px;color:#93a3b8;");
  </script>
</body>
</html>
```Ó®Å0Ó®Ç
