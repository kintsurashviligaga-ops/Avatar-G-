<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Avatar G ‚Äî GPT Style UI</title>
  <style>
    :root{
      --bg:#0b1020;
      --panel:rgba(255,255,255,.06);
      --panel2:rgba(255,255,255,.04);
      --line:rgba(255,255,255,.10);
      --text:rgba(255,255,255,.92);
      --muted:rgba(255,255,255,.62);
      --accent:#22d3ee;
      --accent2:#3b82f6;
      --danger:#ff6b6b;
      --shadow: 0 18px 60px rgba(0,0,0,.40);
      --r:18px;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial;
      color:var(--text);
      background:
        radial-gradient(1200px 700px at 70% 10%, rgba(34,211,238,.13), transparent 60%),
        radial-gradient(1000px 600px at 10% 25%, rgba(59,130,246,.10), transparent 55%),
        var(--bg);
    }

    /* Layout */
    .app{
      height:100%;
      display:grid;
      grid-template-columns: 320px 1fr;
      gap:14px;
      padding:14px;
    }
    .sidebar, .chatShell{
      border:1px solid var(--line);
      background:rgba(0,0,0,.22);
      border-radius:22px;
      backdrop-filter: blur(10px);
      box-shadow: var(--shadow);
      overflow:hidden;
    }

    /* Sidebar */
    .sbTop{
      padding:16px;
      border-bottom:1px solid var(--line);
      background: linear-gradient(135deg, rgba(34,211,238,.14), rgba(59,130,246,.10));
      display:flex; align-items:center; justify-content:space-between; gap:10px;
    }
    .brand{display:flex; gap:10px; align-items:center}
    .logo{
      width:42px;height:42px;border-radius:14px;
      display:grid;place-items:center;
      font-weight:1000; letter-spacing:.3px;
      background:linear-gradient(135deg, rgba(34,211,238,.35), rgba(59,130,246,.18));
      border:1px solid rgba(34,211,238,.25);
    }
    .brandTitle{line-height:1.1}
    .brandTitle b{display:block;font-size:14px;font-weight:1000}
    .brandTitle span{display:block;font-size:12px;color:rgba(255,255,255,.70);font-weight:700;margin-top:2px}

    .sbBtn{
      border:none;
      background:rgba(255,255,255,.10);
      color:var(--text);
      padding:10px 12px;
      border-radius:14px;
      cursor:pointer;
      font-weight:900;
      border:1px solid var(--line);
    }
    .sbBtn:hover{background:rgba(255,255,255,.14)}

    .sbBody{padding:14px; display:grid; gap:14px}
    .sectionLabel{
      font-size:12px; text-transform:uppercase;
      letter-spacing:.6px;
      color:var(--muted);
      font-weight:900;
      margin-bottom:8px;
    }

    /* Project list (GPT-like) */
    .list{display:grid; gap:8px}
    .item{
      border:1px solid var(--line);
      background:rgba(255,255,255,.05);
      border-radius:16px;
      padding:12px;
      display:flex; gap:10px; align-items:center;
      cursor:pointer;
      transition:.15s ease;
    }
    .item:hover{transform: translateY(-1px); background:rgba(255,255,255,.07)}
    .item.active{
      border:1.5px solid rgba(34,211,238,.45);
      background: linear-gradient(135deg, rgba(34,211,238,.14), rgba(59,130,246,.10));
    }
    .itemIcon{font-size:18px}
    .itemMeta{min-width:0; flex:1}
    .itemMeta b{
      display:block; font-size:13px; font-weight:950;
      white-space:nowrap; overflow:hidden; text-overflow:ellipsis;
    }
    .itemMeta span{display:block; font-size:11px; color:var(--muted); margin-top:3px}
    .miniDel{
      border:1px solid rgba(255,107,107,.25);
      background:rgba(255,107,107,.10);
      color:var(--danger);
      border-radius:10px;
      padding:6px 8px;
      cursor:pointer;
      font-weight:1000;
    }

    /* Mode chips */
    .chips{display:flex; flex-wrap:wrap; gap:8px}
    .chip{
      border:1px solid var(--line);
      background:rgba(255,255,255,.04);
      color:var(--text);
      padding:8px 10px;
      border-radius:999px;
      font-weight:900;
      font-size:12px;
      cursor:pointer;
    }
    .chip.active{
      border:1px solid rgba(34,211,238,.35);
      background:rgba(34,211,238,.10);
      color:rgba(255,255,255,.95);
    }

    /* Chat shell */
    .chatHeader{
      padding:14px 16px;
      border-bottom:1px solid var(--line);
      display:flex; align-items:center; justify-content:space-between; gap:10px;
      background:rgba(255,255,255,.03);
    }
    .chatHeader b{font-size:14px; font-weight:1000}
    .chatHeader span{font-size:12px; color:var(--muted); font-weight:700}
    .hdrRight{display:flex; gap:8px; align-items:center}
    .pill{
      font-size:12px; font-weight:900;
      padding:8px 10px;
      border-radius:999px;
      border:1px solid rgba(34,211,238,.22);
      background:rgba(34,211,238,.08);
      color:rgba(255,255,255,.86);
    }
    .ghostBtn{
      border:1px solid var(--line);
      background:rgba(255,255,255,.05);
      color:var(--text);
      padding:10px 12px;
      border-radius:14px;
      cursor:pointer;
      font-weight:900;
    }
    .ghostBtn:hover{background:rgba(255,255,255,.08)}

    .chatBody{
      height: calc(100% - 62px - 92px);
      overflow:auto;
      padding:16px;
      scroll-behavior:smooth;
    }

    /* Messages (GPT-like) */
    .msgRow{display:flex; margin:10px 0}
    .msgRow.user{justify-content:flex-end}
    .bubble{
      max-width:min(760px, 92%);
      border-radius:18px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.06);
      padding:12px 14px;
      line-height:1.6;
      font-size:14px;
      white-space:pre-wrap;
    }
    .user .bubble{
      border:1.5px solid rgba(34,211,238,.32);
      background: linear-gradient(135deg, rgba(34,211,238,.14), rgba(59,130,246,.10));
      box-shadow: 0 10px 30px rgba(34,211,238,.10);
    }
    .assistant .bubble{
      background:rgba(0,0,0,.24);
    }

    /* Attachments cards in chat */
    .attGrid{display:grid; gap:8px; margin-top:10px}
    .attCard{
      border:1px solid var(--line);
      background:rgba(255,255,255,.05);
      border-radius:16px;
      padding:10px 12px;
      display:flex; gap:10px; align-items:center;
      font-size:12px;
    }
    .attIcon{
      width:44px;height:44px;border-radius:12px;
      display:grid;place-items:center;
      border:1px solid var(--line);
      background:rgba(0,0,0,.18);
      font-size:18px;
      flex:0 0 auto;
      overflow:hidden;
    }
    .attIcon img{width:100%;height:100%;object-fit:cover}
    .attMeta{min-width:0; flex:1}
    .attMeta b{display:block; font-weight:1000; font-size:12px; white-space:nowrap; overflow:hidden; text-overflow:ellipsis}
    .attMeta span{display:block; color:var(--muted); margin-top:2px; font-weight:700; font-size:11px}
    .attBtns{display:flex; gap:6px}
    .miniBtn{
      border:1px solid var(--line);
      background:rgba(255,255,255,.05);
      color:var(--text);
      padding:6px 8px;
      border-radius:10px;
      cursor:pointer;
      font-weight:900;
      font-size:11px;
    }
    .miniBtn.danger{
      border:1px solid rgba(255,107,107,.25);
      background:rgba(255,107,107,.10);
      color:var(--danger);
    }

    /* Composer */
    .composer{
      border-top:1px solid var(--line);
      background:rgba(255,255,255,.03);
      padding:12px;
    }
    .composerInner{
      display:grid;
      grid-template-columns:auto 1fr auto;
      gap:10px;
      align-items:flex-end;
    }
    .iconBtn{
      width:44px;height:44px;border-radius:14px;
      border:1px solid var(--line);
      background:rgba(255,255,255,.06);
      color:var(--text);
      cursor:pointer;
      display:grid; place-items:center;
      font-size:18px;
      font-weight:900;
    }
    .iconBtn:hover{background:rgba(255,255,255,.10)}
    textarea{
      width:100%;
      resize:none;
      border-radius:16px;
      border:1.5px solid var(--line);
      background:rgba(0,0,0,.25);
      color:var(--text);
      padding:12px 12px;
      outline:none;
      font-size:14px;
      line-height:1.5;
      min-height:44px;
      max-height:140px;
    }
    .sendBtn{
      height:44px;
      padding:0 18px;
      border:none;
      border-radius:14px;
      font-weight:1000;
      cursor:pointer;
      color:#001018;
      background: linear-gradient(135deg, rgba(34,211,238,.85), rgba(59,130,246,.45));
      box-shadow: 0 10px 30px rgba(34,211,238,.14);
    }
    .sendBtn:disabled{
      cursor:not-allowed;
      opacity:.6;
      box-shadow:none;
    }

    /* Drag overlay */
    .dropOverlay{
      position:absolute;
      inset:0;
      display:none;
      place-items:center;
      z-index:50;
      background:rgba(0,0,0,.58);
      backdrop-filter: blur(5px);
    }
    .dropOverlay.active{display:grid}
    .dropBox{
      border-radius:22px;
      border:2px dashed rgba(34,211,238,.55);
      background: linear-gradient(135deg, rgba(34,211,238,.16), rgba(59,130,246,.10));
      padding:26px 28px;
      text-align:center;
      max-width:420px;
    }
    .dropBox .big{font-size:44px;margin-bottom:10px}
    .dropBox b{display:block;font-size:18px;font-weight:1000;color:rgba(255,255,255,.95)}
    .dropBox span{display:block;margin-top:6px;color:var(--muted);font-weight:800}

    /* Mobile */
    @media (max-width: 980px){
      .app{grid-template-columns:1fr}
      .sidebar{display:none}
      .chatBody{height: calc(100% - 62px - 92px);}
      body{overflow:hidden}
      .app{padding:10px}
    }
  </style>
</head>
<body>
  <div class="app">
    <!-- Sidebar -->
    <aside class="sidebar">
      <div class="sbTop">
        <div class="brand">
          <div class="logo">AG</div>
          <div class="brandTitle">
            <b>Avatar G</b>
            <span>GPT-Style Workspace</span>
          </div>
        </div>
        <button class="sbBtn" id="newProjectBtn">+ Project</button>
      </div>

      <div class="sbBody">
        <div>
          <div class="sectionLabel">Projects</div>
          <div class="list" id="projectsList"></div>
        </div>

        <div>
          <div class="sectionLabel">Mode</div>
          <div class="chips" id="modeChips"></div>
        </div>

        <div>
          <div class="sectionLabel">Quick Actions</div>
          <div class="chips">
            <button class="chip" id="clearChatBtn">üßπ Clear Chat</button>
            <button class="chip" id="demoBtn">‚ú® Demo Reply</button>
          </div>
        </div>
      </div>
    </aside>

    <!-- Chat -->
    <section class="chatShell" style="position:relative;">
      <div class="dropOverlay" id="dropOverlay">
        <div class="dropBox">
          <div class="big">üìÇ</div>
          <b>Drop files here</b>
          <span>They will appear as attachment cards (GPT-style)</span>
        </div>
      </div>

      <header class="chatHeader">
        <div>
          <b>üí¨ Avatar G Chat</b>
          <div><span id="hdrInfo">Project: Default ‚Ä¢ Mode: General</span></div>
        </div>
        <div class="hdrRight">
          <div class="pill" id="pill">Production UI</div>
          <button class="ghostBtn" id="openSidebarMobile" style="display:none;">‚ò∞</button>
        </div>
      </header>

      <main class="chatBody" id="chatBody"></main>

      <footer class="composer">
        <div class="composerInner">
          <button class="iconBtn" id="attachBtn" title="Attach">üìé</button>
          <textarea id="input" placeholder="Write a message‚Ä¶ (Enter = send, Shift+Enter = new line)"></textarea>
          <button class="sendBtn" id="sendBtn">Send</button>
        </div>
        <input id="fileInput" type="file" style="display:none" multiple />
      </footer>
    </section>
  </div>

  <script>
    // ======= Simple local state (for GitHub Pages demo) =======
    const KEY = "ag_gpt_ui_state_v1";

    const MODES = [
      { id:"general", label:"üí¨ General" },
      { id:"avatar", label:"üßë‚Äçüé≠ Avatar" },
      { id:"voice", label:"üé§ Voice" },
      { id:"music", label:"üéµ Music" },
      { id:"video", label:"üé¨ Video" },
      { id:"photo", label:"üì∏ Photo" },
      { id:"marketing", label:"üìà Marketing" },
    ];

    const defaultState = {
      activeProjectId: "default",
      mode: "general",
      projects: [
        { id:"default", name:"My First Project", createdAt: new Date().toISOString() }
      ],
      messages: [
        { role:"assistant", content:
`·Éí·Éê·Éõ·Éê·É†·ÉØ·Éù·Éë·Éê! üëã ·Éõ·Éî ·Éï·Éê·É† Avatar G Workspace (GPT-style UI).

‚úÖ ·Éõ·Éê·É†·É™·ÉÆ·Éú·Éò·Éï: Projects + Mode
‚úÖ ·É®·É£·Éê·É®·Éò: Chat
‚úÖ ·É•·Éï·Éî·Éõ·Éù·Éó: Composer (Attach + Send)
‚úÖ Drag & Drop ·Éõ·ÉÆ·Éê·É†·Éì·Éê·É≠·Éî·É†·Éê

·Éõ·Éò·Éó·ÉÆ·Éê·É†·Éò ·É†·Éê·É° ·Éê·Éô·Éî·Éó·Éî·Éë ·Éì·É¶·Éî·É°?`
        ],
      attachmentsByProject: { "default": [] }
    };

    function load() {
      try{
        const raw = localStorage.getItem(KEY);
        if(!raw) return structuredClone(defaultState);
        const parsed = JSON.parse(raw);
        // minimal safety
        if(!parsed.projects || !parsed.messages) return structuredClone(defaultState);
        return parsed;
      }catch{
        return structuredClone(defaultState);
      }
    }
    function save() {
      localStorage.setItem(KEY, JSON.stringify(state));
    }

    let state = load();

    // ======= DOM refs =======
    const projectsList = document.getElementById("projectsList");
    const modeChips = document.getElementById("modeChips");
    const chatBody = document.getElementById("chatBody");
    const hdrInfo = document.getElementById("hdrInfo");
    const newProjectBtn = document.getElementById("newProjectBtn");
    const clearChatBtn = document.getElementById("clearChatBtn");
    const demoBtn = document.getElementById("demoBtn");
    const input = document.getElementById("input");
    const sendBtn = document.getElementById("sendBtn");
    const attachBtn = document.getElementById("attachBtn");
    const fileInput = document.getElementById("fileInput");
    const dropOverlay = document.getElementById("dropOverlay");

    function activeProject() {
      return state.projects.find(p => p.id === state.activeProjectId) || state.projects[0];
    }
    function activeAttachments() {
      return state.attachmentsByProject[state.activeProjectId] || [];
    }

    // ======= Render =======
    function renderProjects(){
      projectsList.innerHTML = "";
      state.projects.forEach(p => {
        const div = document.createElement("div");
        div.className = "item" + (p.id === state.activeProjectId ? " active":"");
        div.innerHTML = `
          <div class="itemIcon">${p.id === state.activeProjectId ? "üìÇ":"üìÅ"}</div>
          <div class="itemMeta">
            <b>${escapeHtml(p.name)}</b>
            <span>${new Date(p.createdAt).toLocaleDateString()}</span>
          </div>
          ${p.id !== "default" ? `<button class="miniDel" title="Delete">üóëÔ∏è</button>` : ``}
        `;
        div.addEventListener("click", () => {
          state.activeProjectId = p.id;
          save(); renderAll();
        });
        const del = div.querySelector(".miniDel");
        if(del){
          del.addEventListener("click", (e) => {
            e.stopPropagation();
            if(!confirm("Delete this project? (attachments remain stored in demo state)")) return;
            state.projects = state.projects.filter(x => x.id !== p.id);
            if(state.activeProjectId === p.id) state.activeProjectId = "default";
            // keep attachmentsByProject for safety
            save(); renderAll();
          });
        }
        projectsList.appendChild(div);
      });
    }

    function renderModes(){
      modeChips.innerHTML = "";
      MODES.forEach(m => {
        const b = document.createElement("button");
        b.className = "chip" + (m.id === state.mode ? " active":"");
        b.textContent = m.label;
        b.addEventListener("click", () => { state.mode = m.id; save(); renderHeader(); renderModes(); });
        modeChips.appendChild(b);
      });
    }

    function renderHeader(){
      const p = activeProject();
      const modeLabel = MODES.find(x => x.id === state.mode)?.label || "General";
      hdrInfo.textContent = `Project: ${p ? p.name : "Default"} ‚Ä¢ Mode: ${modeLabel.replace(/^[^ ]+ /,"")}`;
    }

    function renderChat(){
      chatBody.innerHTML = "";
      state.messages.forEach((m, idx) => {
        const row = document.createElement("div");
        row.className = "msgRow " + (m.role === "user" ? "user":"assistant");
        const bubble = document.createElement("div");
        bubble.className = "bubble";
        bubble.textContent = m.content;
        row.appendChild(bubble);
        chatBody.appendChild(row);

        // Attachments shown after last assistant message (GPT-like)
        if(idx === state.messages.length - 1){
          const atts = activeAttachments();
          if(atts.length){
            const grid = document.createElement("div");
            grid.className = "attGrid";
            atts.forEach((a, i) => {
              const card = document.createElement("div");
              card.className = "attCard";
              const icon = document.createElement("div");
              icon.className = "attIcon";
              if(a.preview){
                const img = document.createElement("img");
                img.src = a.preview;
                icon.appendChild(img);
              } else {
                icon.textContent = a.kind === "pdf" ? "PDF" : "üìé";
              }

              const meta = document.createElement("div");
              meta.className = "attMeta";
              meta.innerHTML = `<b>${escapeHtml(a.name)}</b><span>${escapeHtml(a.type)} ‚Ä¢ ${Math.round(a.size/1024)} KB</span>`;

              const btns = document.createElement("div");
              btns.className = "attBtns";
              const view = document.createElement("button");
              view.className = "miniBtn";
              view.textContent = "üëÅÔ∏è View";
              view.addEventListener("click", () => {
                if(a.preview) window.open(a.preview, "_blank");
                else alert("Demo file: no remote URL set yet.");
              });

              const del = document.createElement("button");
              del.className = "miniBtn danger";
              del.textContent = "üóëÔ∏è";
              del.addEventListener("click", () => {
                const list = activeAttachments().filter((_,ix)=> ix !== i);
                state.attachmentsByProject[state.activeProjectId] = list;
                save(); renderChat(); scrollBottom();
              });

              btns.appendChild(view);
              btns.appendChild(del);

              card.appendChild(icon);
              card.appendChild(meta);
              card.appendChild(btns);
              grid.appendChild(card);
            });
            chatBody.appendChild(grid);
          }
        }
      });
      scrollBottom();
    }

    function renderAll(){
      renderProjects();
      renderModes();
      renderHeader();
      renderChat();
    }

    function scrollBottom(){
      chatBody.scrollTop = chatBody.scrollHeight;
    }

    // ======= Actions =======
    newProjectBtn.addEventListener("click", () => {
      const name = prompt("Project name:");
      if(!name || !name.trim()) return;
      const id = crypto.randomUUID ? crypto.randomUUID() : ("p_" + Math.random().toString(36).slice(2));
      state.projects.push({ id, name: name.trim(), createdAt: new Date().toISOString() });
      state.attachmentsByProject[id] = [];
      state.activeProjectId = id;
      save(); renderAll();
    });

    clearChatBtn.addEventListener("click", () => {
      if(!confirm("Clear chat messages?")) return;
      state.messages = [ { role:"assistant", content:"Chat cleared ‚úÖ\n\nWrite your next request." } ];
      save(); renderChat();
    });

    demoBtn.addEventListener("click", () => {
      state.messages.push({ role:"assistant", content:
`‚úÖ Demo response (GPT-style)

Mode: ${state.mode}
Project: ${activeProject().name}

·Éõ·Éù·Éõ·É¨·Éî·É†·Éî ·É†·Éê ·Éí·Éò·Éú·Éì·Éê ·Éì·Éê ·É®·Éî·Éõ·Éì·Éî·Éí ·Éú·Éê·Éë·Éò·ÉØ·Éñ·Éî ·Éê·Éõ·Éê·É° ·Éì·Éê·Éï·É£·Éô·Éê·Éï·É®·Éò·É†·Éî·Éë·Éó Next.js /api/chat-·É°.`});
      save(); renderChat();
    });

    function send(){
      const text = (input.value || "").trim();
      if(!text) return;
      state.messages.push({ role:"user", content:text });
      input.value = "";
      // demo assistant reply
      state.messages.push({ role:"assistant", content:
`Received ‚úÖ

‚Ä¢ Mode: ${state.mode}
‚Ä¢ Project: ${activeProject().name}

·Éê·ÉÆ·Éö·Éê ·Éî·É° UI ·Éê·É†·Éò·É° GPT-·Éò·É° ·É°·É¢·Éò·Éö·É®·Éò. ·É®·Éî·Éõ·Éì·Éî·Éí ·Éî·É¢·Éê·Éû·Éñ·Éî ·Éï·Éê·Éî·É†·Éó·Éî·Éë·Éó ·É†·Éî·Éê·Éö·É£·É† /api/chat-·É° ·Éì·Éê R2 upload-·É°.`});
      save(); renderChat();
    }

    sendBtn.addEventListener("click", send);
    input.addEventListener("keydown", (e) => {
      if(e.key === "Enter" && !e.shiftKey){
        e.preventDefault(); send();
      }
    });

    // Attach files (demo local preview)
    attachBtn.addEventListener("click", () => fileInput.click());
    fileInput.addEventListener("change", async (e) => {
      const files = Array.from(e.target.files || []);
      if(!files.length) return;
      await addFiles(files);
      fileInput.value = "";
    });

    // Drag & Drop
    let dragCount = 0;
    document.addEventListener("dragenter", (e) => {
      e.preventDefault(); dragCount++;
      dropOverlay.classList.add("active");
    });
    document.addEventListener("dragleave", (e) => {
      e.preventDefault(); dragCount--;
      if(dragCount <= 0){
        dragCount = 0;
        dropOverlay.classList.remove("active");
      }
    });
    document.addEventListener("dragover", (e) => { e.preventDefault(); });
    document.addEventListener("drop", async (e) => {
      e.preventDefault();
      dragCount = 0;
      dropOverlay.classList.remove("active");
      const files = Array.from(e.dataTransfer.files || []);
      if(files.length) await addFiles(files);
    });

    async function addFiles(files){
      const list = activeAttachments();
      for(const file of files){
        const kind = file.type === "application/pdf" ? "pdf" : (file.type.startsWith("image/") ? "img" : "file");
        const att = { name:file.name, type:file.type||"file", size:file.size, kind, preview:null };
        if(kind === "img"){
          att.preview = await makeThumb(file);
        }
        list.push(att);
      }
      state.attachmentsByProject[state.activeProjectId] = list;
      save(); renderChat();
      state.messages.push({ role:"assistant", content:`‚úÖ Attached ${files.length} file(s) to "${activeProject().name}".`});
      save(); renderChat();
    }

    function makeThumb(file){
      return new Promise((resolve) => {
        const reader = new FileReader();
        reader.onload = (ev) => {
          const img = new Image();
          img.onload = () => {
            const c = document.createElement("canvas");
            const size = 72;
            c.width = size; c.height = size;
            const ctx = c.getContext("2d");
            const scale = Math.max(size/img.width, size/img.height);
            const x = (size - img.width*scale)/2;
            const y = (size - img.height*scale)/2;
            ctx.drawImage(img, x, y, img.width*scale, img.height*scale);
            resolve(c.toDataURL("image/jpeg", .82));
          };
          img.onerror = () => resolve(null);
          img.src = ev.target.result;
        };
        reader.onerror = () => resolve(null);
        reader.readAsDataURL(file);
      });
    }

    function escapeHtml(s){
      return String(s).replace(/[&<>"']/g, (m) => ({
        "&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"
      }[m]));
    }

    renderAll();
  </script>
</body>
</html>
