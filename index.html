<!DOCTYPE html>
<html lang="ka">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0" />
  <meta name="theme-color" content="#0b1020" />
  <meta name="description" content="Avatar G â€” áƒ¡áƒáƒ¥áƒáƒ áƒ—áƒ•áƒ”áƒšáƒáƒ¡ áƒáƒ˜áƒ áƒ•áƒ”áƒšáƒ˜ AI Workspace. Chat, Create, Generate - áƒ§áƒ•áƒ”áƒšáƒáƒ¤áƒ”áƒ áƒ˜ áƒ”áƒ áƒ— áƒ¡áƒ˜áƒ•áƒ áƒªáƒ”áƒ¨áƒ˜." />
  <meta name="keywords" content="AI, Avatar, Video, Voice, Music, Georgian AI, áƒ¥áƒáƒ áƒ—áƒ£áƒšáƒ˜ AI, AI Workspace" />
  <meta property="og:title" content="Avatar G â€” AI Workspace" />
  <meta property="og:description" content="Georgian AI-powered Media Factory. Professional content generation with AI assistance." />
  <meta property="og:type" content="website" />
  <meta name="twitter:card" content="summary_large_image" />
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><defs><linearGradient id='g' x1='0%' y1='0%' x2='100%' y2='100%'><stop offset='0%' style='stop-color:%2322d3ee'/><stop offset='100%' style='stop-color:%233b82f6'/></linearGradient></defs><rect width='100' height='100' rx='20' fill='url(%23g)'/><text x='50' y='70' font-size='60' font-weight='900' text-anchor='middle' fill='%23071018' font-family='system-ui'>G</text></svg>" />
  <title>Avatar G â€” AI Workspace</title>

  <style>
    :root{
      --bg0:#060815;
      --bg1:#0b1020;
      --bg2:#10172a;
      --glass:rgba(255,255,255,.08);
      --glass2:rgba(255,255,255,.12);
      --stroke:rgba(255,255,255,.14);
      --strokeHover:rgba(34,211,238,.35);
      --text:#e5e7eb;
      --textBright:#f9fafb;
      --muted:#93a3b8;
      --shadow:0 24px 80px rgba(0,0,0,.45);
      --shadowHover:0 28px 90px rgba(0,0,0,.55);
      --radius:18px;
      --radiusSm:14px;
      --brand:#22d3ee;
      --brand2:#3b82f6;
      --brandGrad:linear-gradient(135deg, rgba(34,211,238,.95), rgba(59,130,246,.95));
      --ok:#22c55e;
      --warn:#f59e0b;
      --danger:#ef4444;
      --purple:#a855f7;
      --transition:all .28s cubic-bezier(.4,0,.2,1);
      --transitionFast:all .18s cubic-bezier(.4,0,.2,1);
    }

    *{box-sizing:border-box;margin:0;padding:0}
    html{scroll-behavior:smooth}
    html,body{height:100%;overflow:hidden}
    body{
      font-family:ui-sans-serif,system-ui,-apple-system,"SF Pro Display","Segoe UI",Roboto,"Noto Sans Georgian",sans-serif;
      color:var(--text);
      background:
        radial-gradient(1200px 700px at 18% 8%, rgba(34,211,238,.26), transparent 60%),
        radial-gradient(1000px 700px at 82% 18%, rgba(59,130,246,.22), transparent 60%),
        radial-gradient(1000px 800px at 50% 88%, rgba(34,197,94,.14), transparent 65%),
        linear-gradient(180deg, var(--bg1) 0%, var(--bg0) 100%);
      background-attachment:fixed;
      line-height:1.6;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
    }

    ::selection{background:rgba(34,211,238,.28);color:var(--textBright)}
    button{font-family:inherit;cursor:pointer;border:none;outline:none}
    input,textarea,select{font-family:inherit}

    .app{display:flex;flex-direction:column;height:100vh;overflow:hidden}

    .header{
      flex:0 0 auto;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:16px;
      padding:16px 20px;
      border-bottom:1px solid var(--stroke);
      background:linear-gradient(135deg, rgba(255,255,255,.12), rgba(255,255,255,.08));
      backdrop-filter:blur(20px) saturate(180%);
      -webkit-backdrop-filter:blur(20px) saturate(180%);
      box-shadow:0 6px 30px rgba(0,0,0,.18);
      z-index:100;
    }

    .brand{
      display:flex;align-items:center;gap:14px;cursor:pointer;
      transition:var(--transitionFast);
      outline:none;border-radius:14px;padding:6px 10px 6px 6px;
    }
    .brand:hover{background:rgba(255,255,255,.07);transform:translateX(2px)}
    .brand:active{transform:scale(.98)}
    .brand:focus-visible{box-shadow:0 0 0 3px rgba(34,211,238,.20)}

    .logo{
      width:48px;height:48px;border-radius:14px;display:grid;place-items:center;
      flex:0 0 auto;position:relative;overflow:hidden;
      background:var(--brandGrad);
      box-shadow:
        0 16px 48px rgba(34,211,238,.24),
        inset 0 1px 0 rgba(255,255,255,.35),
        inset 0 -1px 0 rgba(0,0,0,.15);
      user-select:none;
      transition:var(--transitionFast);
    }
    .brand:hover .logo{transform:rotate(-6deg) scale(1.08)}

    .logo svg{width:100%;height:100%;display:block}
    .logo-shine{
      position:absolute;top:-50%;left:-50%;width:200%;height:200%;
      background:linear-gradient(45deg, transparent 30%, rgba(255,255,255,.25) 50%, transparent 70%);
      animation:shine 3s ease-in-out infinite;
      pointer-events:none;
    }
    @keyframes shine{
      0%,100%{transform:translateX(-100%)}
      50%{transform:translateX(100%)}
    }

    .brandtext{display:flex;flex-direction:column;line-height:1.2;min-width:0}
    .title{
      font-weight:900;font-size:16px;color:var(--textBright);letter-spacing:.4px;
      background:linear-gradient(135deg, var(--textBright), var(--brand));
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
      background-clip:text;
    }
    .subtitle{font-size:11.5px;color:var(--muted);margin-top:2px;font-weight:600}

    .headerRight{display:flex;align-items:center;gap:12px;flex-wrap:wrap;justify-content:flex-end}

    .creditBadge{
      display:flex;align-items:center;gap:9px;padding:9px 14px;
      background:linear-gradient(135deg, rgba(34,211,238,.14), rgba(59,130,246,.10));
      border:1px solid rgba(34,211,238,.30);
      border-radius:999px;
      font-size:13px;font-weight:900;
      color:var(--brand);
      transition:var(--transitionFast);
      white-space:nowrap;
      box-shadow:0 8px 24px rgba(34,211,238,.12);
    }
    .creditBadge:hover{
      background:linear-gradient(135deg, rgba(34,211,238,.18), rgba(59,130,246,.14));
      border-color:rgba(34,211,238,.40);
      transform:translateY(-1px);
      box-shadow:0 12px 32px rgba(34,211,238,.18);
    }
    .creditBadge span{color:var(--text);font-weight:700}
    .creditBadge strong{font-size:16px}

    .miniBtn{
      padding:10px 14px;
      background:rgba(255,255,255,.08);
      border:1px solid var(--stroke);
      border-radius:12px;
      font-weight:900;font-size:13px;color:var(--text);
      transition:var(--transitionFast);
      white-space:nowrap;
      box-shadow:0 4px 16px rgba(0,0,0,.08);
    }
    .miniBtn:hover{
      background:rgba(255,255,255,.12);
      border-color:var(--strokeHover);
      transform:translateY(-2px);
      box-shadow:0 8px 24px rgba(0,0,0,.14);
    }
    .miniBtn:active{transform:translateY(0)}

    .selectWrap{position:relative}
    .select{
      appearance:none;
      padding:10px 36px 10px 14px;
      background:rgba(255,255,255,.08);
      border:1px solid var(--stroke);
      border-radius:12px;
      color:var(--text);
      font-weight:900;font-size:13px;
      cursor:pointer;outline:none;
      transition:var(--transitionFast);
      box-shadow:0 4px 16px rgba(0,0,0,.08);
    }
    .select:hover{
      background:rgba(255,255,255,.12);
      border-color:var(--strokeHover);
      transform:translateY(-1px);
    }
    .select:focus{
      border-color:var(--brand);
      box-shadow:0 0 0 3px rgba(34,211,238,.18);
    }
    .selectWrap:after{
      content:"â–¾";
      position:absolute;right:12px;top:50%;transform:translateY(-50%);
      color:var(--muted);pointer-events:none;font-size:13px;font-weight:900;
    }

    .container{flex:1 1 auto;display:flex;overflow:hidden;position:relative}

    .sidebar{
      flex:0 0 300px;
      display:flex;flex-direction:column;gap:14px;
      padding:18px;
      border-right:1px solid var(--stroke);
      background:linear-gradient(180deg, rgba(255,255,255,.04) 0%, rgba(255,255,255,.02) 100%);
      overflow-y:auto;
    }

    .sidebarTitle{
      font-size:13.5px;font-weight:900;color:var(--muted);
      letter-spacing:1px;text-transform:uppercase;
      margin-bottom:8px;padding:0 6px;
      display:flex;align-items:center;justify-content:space-between;gap:12px;
    }

    .activeChip{
      font-size:10px;font-weight:900;
      padding:5px 10px;border-radius:999px;
      background:linear-gradient(135deg, rgba(34,211,238,.18), rgba(59,130,246,.14));
      border:1px solid rgba(34,211,238,.32);
      color:var(--brand);
      letter-spacing:.6px;
      white-space:nowrap;
      box-shadow:0 4px 16px rgba(34,211,238,.15);
      animation:pulse-chip 2s ease-in-out infinite;
    }
    @keyframes pulse-chip{
      0%,100%{opacity:1}
      50%{opacity:.85}
    }

    .serviceCard{
      padding:16px;
      background:linear-gradient(135deg, rgba(255,255,255,.11), rgba(255,255,255,.07));
      border:1px solid var(--stroke);
      border-radius:16px;
      cursor:pointer;
      transition:var(--transition);
      position:relative;overflow:hidden;
      outline:none;
      box-shadow:0 8px 32px rgba(0,0,0,.12);
    }
    .serviceCard:hover{
      background:linear-gradient(135deg, rgba(255,255,255,.14), rgba(255,255,255,.09));
      border-color:var(--strokeHover);
      transform:translateX(4px) translateY(-2px);
      box-shadow:0 12px 40px rgba(0,0,0,.18);
    }
    .serviceCard:active{transform:translateX(2px) translateY(0)}
    .serviceCard:focus-visible{box-shadow:0 0 0 3px rgba(34,211,238,.20), 0 8px 32px rgba(0,0,0,.12)}
    .serviceCard.active{
      border-color:rgba(34,211,238,.60);
      box-shadow:
        0 12px 48px rgba(34,211,238,.14),
        inset 0 1px 0 rgba(255,255,255,.12);
      background:linear-gradient(135deg, rgba(34,211,238,.16), rgba(59,130,246,.11));
    }

    .serviceCard::before{
      content:'';
      position:absolute;left:0;top:0;bottom:0;width:4px;
      background:linear-gradient(180deg, var(--brand), var(--brand2));
      opacity:0;transition:opacity .3s ease;
      border-radius:16px 0 0 16px;
    }
    .serviceCard:hover::before, .serviceCard.active::before{opacity:1}

    .serviceTop{display:flex;align-items:center;gap:12px;margin-bottom:8px}

    .serviceIcon{
      width:40px;height:40px;border-radius:12px;display:grid;place-items:center;
      background:linear-gradient(135deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
      border:1px solid var(--stroke);
      font-size:20px;flex:0 0 auto;
      box-shadow:inset 0 1px 0 rgba(255,255,255,.15);
      transition:var(--transitionFast);
    }
    .serviceCard:hover .serviceIcon{
      transform:scale(1.12) rotate(-4deg);
      background:linear-gradient(135deg, rgba(255,255,255,.14), rgba(255,255,255,.09));
    }

    .serviceCard h4{font-size:15px;font-weight:900;color:var(--textBright);letter-spacing:.3px}
    .serviceCard p{font-size:12.5px;color:var(--muted);line-height:1.5;font-weight:500}

    .serviceBadge{
      position:absolute;right:12px;top:12px;
      font-size:9.5px;font-weight:900;padding:5px 10px;border-radius:999px;
      background:linear-gradient(135deg, rgba(34,211,238,.24), rgba(59,130,246,.20));
      color:var(--brand);
      border:1px solid rgba(34,211,238,.35);
      letter-spacing:.6px;
      user-select:none;
      box-shadow:0 4px 16px rgba(34,211,238,.15);
    }

    .costLine{
      margin-top:12px;
      display:flex;align-items:center;justify-content:space-between;gap:12px;
      font-size:11.5px;color:var(--muted);
      padding-top:12px;border-top:1px dashed rgba(255,255,255,.12);
      font-weight:600;
    }
    .costLine strong{
      color:var(--brand);
      font-weight:900;
      font-size:13px;
    }

    .main{flex:1 1 auto;display:flex;flex-direction:column;overflow:hidden;position:relative}

    .chatContainer{
      flex:1 1 auto;overflow-y:auto;padding:24px;
      display:flex;flex-direction:column;gap:18px;
    }

    .emptyState{
      flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;
      gap:20px;padding:48px 24px;text-align:center;
    }

    .emptyIcon{
      width:88px;height:88px;border-radius:22px;display:grid;place-items:center;
      background:var(--brandGrad);font-size:44px;
      box-shadow:
        0 24px 70px rgba(34,211,238,.28),
        inset 0 2px 0 rgba(255,255,255,.30),
        inset 0 -2px 0 rgba(0,0,0,.15);
      animation:float 3.5s ease-in-out infinite;
      position:relative;
    }
    .emptyIcon::after{
      content:'';
      position:absolute;inset:-4px;
      border-radius:24px;
      background:linear-gradient(135deg, transparent, rgba(34,211,238,.15), transparent);
      opacity:.5;
      filter:blur(8px);
      animation:rotate 4s linear infinite;
    }

    @keyframes float{0%,100%{transform:translateY(0)}50%{transform:translateY(-12px)}}
    @keyframes rotate{to{transform:rotate(360deg)}}

    .emptyState h2{
      font-size:26px;font-weight:900;
      color:var(--textBright);letter-spacing:.4px;
      background:linear-gradient(135deg, var(--textBright), var(--brand));
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
      background-clip:text;
    }
    .emptyState p{font-size:14.5px;color:var(--muted);max-width:440px;line-height:1.7;font-weight:500}

    .quickActions{display:flex;flex-wrap:wrap;gap:12px;justify-content:center;margin-top:12px}

    .quickBtn{
      padding:11px 18px;
      background:linear-gradient(135deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
      border:1px solid var(--stroke);
      border-radius:12px;
      font-size:13.5px;font-weight:800;color:var(--text);
      transition:var(--transitionFast);
      box-shadow:0 6px 24px rgba(0,0,0,.10);
    }
    .quickBtn:hover{
      background:linear-gradient(135deg, rgba(34,211,238,.16), rgba(59,130,246,.12));
      border-color:var(--brand);
      transform:translateY(-3px);
      box-shadow:0 10px 32px rgba(34,211,238,.18);
      color:var(--textBright);
    }
    .quickBtn:active{transform:translateY(-1px)}

    .message{display:flex;gap:14px;align-items:flex-start;animation:messageIn .35s ease-out}
    @keyframes messageIn{from{opacity:0;transform:translateY(12px)}to{opacity:1;transform:translateY(0)}}

    .messageAvatar{
      width:40px;height:40px;border-radius:12px;display:grid;place-items:center;
      flex:0 0 auto;font-size:20px;
      background:linear-gradient(135deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
      border:1px solid var(--stroke);
      user-select:none;
      box-shadow:0 6px 20px rgba(0,0,0,.10);
    }
    .message.user .messageAvatar{
      background:linear-gradient(135deg, rgba(168,85,247,.40), rgba(217,70,239,.38));
      border-color:rgba(168,85,247,.45);
      box-shadow:0 8px 28px rgba(168,85,247,.18);
    }
    .message.assistant .messageAvatar{
      background:var(--brandGrad);
      box-shadow:0 8px 28px rgba(34,211,238,.18);
    }

    .messageContent{flex:1;display:flex;flex-direction:column;gap:8px;min-width:0}
    .messageMeta{display:flex;align-items:center;gap:10px;font-size:12.5px}
    .messageName{font-weight:900;color:var(--textBright);letter-spacing:.2px}
    .messageTime{color:var(--muted);font-size:11.5px;font-weight:600}

    .messageText{
      padding:16px 18px;
      background:linear-gradient(135deg, rgba(255,255,255,.09), rgba(255,255,255,.06));
      border:1px solid var(--stroke);
      border-radius:14px;
      line-height:1.7;font-size:14px;color:var(--text);
      white-space:pre-wrap;
      word-break:break-word;
      box-shadow:0 6px 24px rgba(0,0,0,.08);
      font-weight:500;
    }
    .message.assistant .messageText{
      background:linear-gradient(135deg, rgba(34,211,238,.14), rgba(59,130,246,.10));
      border-color:rgba(34,211,238,.28);
      box-shadow:0 8px 28px rgba(34,211,238,.10);
    }

    .attachmentPills{display:flex;flex-wrap:wrap;gap:10px;margin-top:10px}
    .pill{
      font-size:11.5px;font-weight:800;
      padding:7px 12px;border-radius:999px;
      background:linear-gradient(135deg, rgba(255,255,255,.09), rgba(255,255,255,.06));
      border:1px solid rgba(255,255,255,.14);
      color:var(--text);
      display:flex;align-items:center;gap:10px;
      max-width:100%;
      box-shadow:0 4px 16px rgba(0,0,0,.08);
    }
    .pill span{color:var(--muted);font-weight:900;font-size:10.5px}
    .pill button{
      width:20px;height:20px;border-radius:50%;
      display:grid;place-items:center;
      background:rgba(255,255,255,.10);
      border:1px solid rgba(255,255,255,.16);
      color:var(--muted);
      transition:var(--transitionFast);
      font-size:11px;
    }
    .pill button:hover{
      background:rgba(239,68,68,.22);
      border-color:rgba(239,68,68,.40);
      color:#fecaca;
      transform:scale(1.1);
    }

    .inputArea{
      flex:0 0 auto;padding:18px 24px;border-top:1px solid var(--stroke);
      background:linear-gradient(180deg, rgba(255,255,255,.05) 0%, rgba(255,255,255,.03) 100%);
      backdrop-filter:blur(16px);
    }

    .inputWrapper{display:flex;gap:12px;align-items:flex-end}

    .inputBox{
      flex:1;display:flex;flex-direction:column;gap:12px;
      padding:14px 16px;
      background:linear-gradient(135deg, rgba(255,255,255,.10), rgba(255,255,255,.07));
      border:1px solid var(--stroke);
      border-radius:16px;
      transition:var(--transition);
      min-width:0;
      box-shadow:0 8px 32px rgba(0,0,0,.10);
    }
    .inputBox:focus-within{
      border-color:var(--brand);
      background:linear-gradient(135deg, rgba(255,255,255,.12), rgba(255,255,255,.08));
      box-shadow:0 0 0 3px rgba(34,211,238,.18), 0 8px 32px rgba(0,0,0,.10);
    }

    .inputTop{display:flex;gap:10px;align-items:center;flex-wrap:wrap}

    .serviceTag{
      padding:6px 12px;
      background:linear-gradient(135deg, rgba(34,211,238,.20), rgba(59,130,246,.16));
      border:1px solid rgba(34,211,238,.35);
      border-radius:10px;font-size:11.5px;font-weight:900;color:var(--brand);
      letter-spacing:.4px;display:flex;align-items:center;gap:8px;
      user-select:none;
      box-shadow:0 4px 16px rgba(34,211,238,.12);
    }
    .serviceTag .costMini{
      padding:3px 10px;border-radius:999px;
      background:rgba(255,255,255,.12);
      border:1px solid rgba(255,255,255,.18);
      color:var(--textBright);
      font-size:10.5px;font-weight:900;
      box-shadow:inset 0 1px 0 rgba(255,255,255,.15);
    }
    .serviceTag button{
      background:none;color:inherit;padding:0;width:16px;height:16px;
      display:grid;place-items:center;border-radius:50%;font-size:11px;
      transition:var(--transitionFast);
    }
    .serviceTag button:hover{
      background:rgba(239,68,68,.30);
      color:#fecaca;
      transform:scale(1.15);
    }

    textarea{
      width:100%;border:none;background:transparent;color:var(--text);
      resize:none;outline:none;font-size:14.5px;line-height:1.6;
      min-height:28px;max-height:130px;
      font-weight:500;
    }
    textarea::placeholder{color:var(--muted);font-weight:500}

    .inputActions{display:flex;gap:10px;align-items:center;justify-content:space-between}
    .leftActions{display:flex;gap:8px;align-items:center}
    .rightActions{display:flex;gap:12px;align-items:center}

    .hintMini{
      font-size:11.5px;color:var(--muted);
      display:flex;align-items:center;gap:10px;white-space:nowrap;
      font-weight:700;
    }
    .hintMini strong{color:var(--brand);font-weight:900;font-size:13px}

    .iconBtn{
      width:36px;height:36px;display:grid;place-items:center;
      background:linear-gradient(135deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
      border:1px solid var(--stroke);
      border-radius:11px;font-size:17px;
      transition:var(--transitionFast);flex:0 0 auto;
      box-shadow:0 4px 16px rgba(0,0,0,.08);
    }
    .iconBtn:hover{
      background:linear-gradient(135deg, rgba(255,255,255,.14), rgba(255,255,255,.09));
      border-color:var(--brand);
      transform:translateY(-2px) scale(1.05);
      box-shadow:0 8px 24px rgba(34,211,238,.12);
    }
    .iconBtn:active{transform:translateY(0) scale(1)}

    .sendBtn{
      padding:14px 22px;
      background:var(--brandGrad);
      border:none;border-radius:14px;color:#051018;
      font-weight:900;font-size:15px;display:flex;align-items:center;gap:8px;
      transition:var(--transition);
      box-shadow:
        0 16px 48px rgba(34,211,238,.28),
        inset 0 2px 0 rgba(255,255,255,.30);
      flex:0 0 auto;
      white-space:nowrap;
    }
    .sendBtn:hover{
      transform:translateY(-3px) scale(1.02);
      box-shadow:0 20px 60px rgba(34,211,238,.38);
    }
    .sendBtn:active{transform:translateY(-1px) scale(1)}
    .sendBtn:disabled{opacity:.55;cursor:not-allowed;transform:none!important}

    .aiHelper{
      position:fixed;right:24px;bottom:24px;width:66px;height:66px;border-radius:50%;
      background:var(--brandGrad);
      box-shadow:
        0 24px 70px rgba(34,211,238,.40),
        inset 0 2px 0 rgba(255,255,255,.30);
      display:grid;place-items:center;font-size:32px;cursor:pointer;
      transition:var(--transition);z-index:999;
      animation:pulse-helper 2.5s ease-in-out infinite;
    }
    .aiHelper:hover{
      transform:scale(1.15) rotate(-12deg);
      box-shadow:0 28px 80px rgba(34,211,238,.50);
    }
    @keyframes pulse-helper{
      0%,100%{box-shadow:0 24px 70px rgba(34,211,238,.40), inset 0 2px 0 rgba(255,255,255,.30)}
      50%{box-shadow:0 28px 90px rgba(34,211,238,.60), inset 0 2px 0 rgba(255,255,255,.30)}
    }

    .overlay{
      position:fixed;inset:0;background:rgba(0,0,0,.70);
      backdrop-filter:blur(12px);
      display:none;align-items:center;justify-content:center;padding:24px;
      z-index:1000;
      animation:fadeIn .3s ease-out;
    }
    @keyframes fadeIn{from{opacity:0}to{opacity:1}}
    .overlay.show{display:flex}

    .modal{
      width:min(780px,100%);max-height:88vh;overflow-y:auto;
      border-radius:20px;
      border:1px solid var(--stroke);
      background:linear-gradient(135deg, rgba(255,255,255,.15), rgba(255,255,255,.09));
      box-shadow:0 40px 160px rgba(0,0,0,.75);
      backdrop-filter:blur(28px) saturate(180%);
      animation:modalSlideIn .4s cubic-bezier(.4,0,.2,1);
    }
    @keyframes modalSlideIn{from{opacity:0;transform:translateY(-40px) scale(.94)}to{opacity:1;transform:translateY(0) scale(1)}}

    .modalHead{
      display:flex;align-items:center;justify-content:space-between;gap:14px;
      padding:20px 24px;border-bottom:1px solid var(--stroke);
      background:linear-gradient(180deg, rgba(255,255,255,.08) 0%, rgba(255,255,255,.04) 100%);
      position:sticky;top:0;z-index:1;
    }

    .modalTitle{display:flex;align-items:center;gap:14px}
    .modalTitle strong{
      font-size:17px;font-weight:900;color:var(--textBright);letter-spacing:.4px;
      background:linear-gradient(135deg, var(--textBright), var(--brand));
      -webkit-background-clip:text;
      -webkit-text-fill-color:transparent;
      background-clip:text;
    }

    .closeBtn{
      width:40px;height:40px;display:grid;place-items:center;
      background:linear-gradient(135deg, rgba(255,255,255,.10), rgba(255,255,255,.06));
      border:1px solid var(--stroke);
      border-radius:12px;font-size:19px;font-weight:900;color:var(--text);
      transition:var(--transitionFast);
      box-shadow:0 4px 16px rgba(0,0,0,.08);
    }
    .closeBtn:hover{
      background:rgba(239,68,68,.22);
      border-color:rgba(239,68,68,.40);
      color:#fecaca;
      transform:rotate(90deg) scale(1.08);
      box-shadow:0 8px 24px rgba(239,68,68,.18);
    }

    .modalBody{padding:24px}

    .hint{
      padding:14px 16px;
      background:linear-gradient(135deg, rgba(34,211,238,.12), rgba(59,130,246,.08));
      border-left:4px solid var(--brand);border-radius:10px;
      font-size:13.5px;color:var(--muted);line-height:1.6;margin-bottom:20px;
      box-shadow:0 6px 24px rgba(34,211,238,.10);
      font-weight:500;
    }

    .formGrid{display:grid;grid-template-columns:1fr 1fr;gap:16px}
    .field{display:flex;flex-direction:column;gap:8px}

    label{font-size:13px;font-weight:900;color:var(--textBright);letter-spacing:.3px}

    input,select{
      width:100%;padding:13px 16px;
      background:linear-gradient(135deg, rgba(255,255,255,.09), rgba(255,255,255,.06));
      border:1px solid var(--stroke);border-radius:14px;
      color:var(--text);font-size:14px;outline:none;
      transition:var(--transition);
      box-shadow:0 4px 16px rgba(0,0,0,.06);
      font-weight:500;
    }
    input:hover,select:hover{
      background:linear-gradient(135deg, rgba(255,255,255,.12), rgba(255,255,255,.08));
      border-color:var(--strokeHover);
    }
    input:focus,select:focus{
      background:linear-gradient(135deg, rgba(255,255,255,.11), rgba(255,255,255,.07));
      border-color:var(--brand);
      box-shadow:0 0 0 3px rgba(34,211,238,.18), 0 4px 16px rgba(0,0,0,.06);
    }
    .promptArea{min-height:130px;resize:vertical;line-height:1.7}
    .full{grid-column:1/-1}

    .templateList{display:flex;flex-direction:column;gap:12px;max-height:340px;overflow-y:auto}
    .templateItem{
      padding:14px 16px;
      background:linear-gradient(135deg, rgba(255,255,255,.09), rgba(255,255,255,.06));
      border:1px solid var(--stroke);border-radius:14px;
      cursor:pointer;transition:var(--transitionFast);
      display:flex;align-items:flex-start;gap:12px;
      outline:none;
      box-shadow:0 4px 16px rgba(0,0,0,.08);
    }
    .templateItem:hover,.templateItem:focus-visible{
      background:linear-gradient(135deg, rgba(34,211,238,.14), rgba(59,130,246,.10));
      border-color:var(--brand);
      transform:translateX(4px);
      box-shadow:0 8px 24px rgba(34,211,238,.12);
    }
    .templateItem strong{font-size:13.5px;color:var(--textBright);display:block;margin-bottom:5px;font-weight:900}
    .templateItem p{font-size:12.5px;color:var(--muted);line-height:1.5;font-weight:500}

    .btnRow{display:flex;gap:12px;justify-content:flex-end;margin-top:20px;flex-wrap:wrap}
    .btn{
      padding:13px 22px;border-radius:14px;
      font-weight:900;font-size:14.5px;
      transition:var(--transition);letter-spacing:.3px;
      box-shadow:0 6px 24px rgba(0,0,0,.10);
    }

    .btnSecondary{
      background:linear-gradient(135deg, rgba(255,255,255,.09), rgba(255,255,255,.06));
      border:1px solid var(--stroke);color:var(--text);
    }
    .btnSecondary:hover{
      background:linear-gradient(135deg, rgba(255,255,255,.13), rgba(255,255,255,.09));
      border-color:var(--strokeHover);
      transform:translateY(-2px);
      box-shadow:0 10px 32px rgba(0,0,0,.16);
    }

    .btnDanger{
      background:linear-gradient(135deg, rgba(239,68,68,.22), rgba(220,38,38,.18));
      border:1px solid rgba(239,68,68,.40);
      color:#fecaca;
    }
    .btnDanger:hover{
      transform:translateY(-2px);
      background:linear-gradient(135deg, rgba(239,68,68,.28), rgba(220,38,38,.24));
      box-shadow:0 10px 32px rgba(239,68,68,.18);
    }

    .btnPrimary{
      background:var(--brandGrad);border:none;color:#051018;
      box-shadow:
        0 20px 70px rgba(34,211,238,.28),
        inset 0 2px 0 rgba(255,255,255,.30);
    }
    .btnPrimary:hover{
      transform:translateY(-3px) scale(1.02);
      box-shadow:0 24px 80px rgba(34,211,238,.38);
    }
    .btnPrimary:disabled{opacity:.55;cursor:not-allowed;transform:none!important}

    .historyList{display:flex;flex-direction:column;gap:12px;max-height:460px;overflow:auto}
    .historyItem{
      padding:14px 16px;border-radius:14px;
      background:linear-gradient(135deg, rgba(255,255,255,.08), rgba(255,255,255,.05));
      border:1px solid rgba(255,255,255,.14);
      display:flex;gap:14px;align-items:flex-start;
      box-shadow:0 4px 16px rgba(0,0,0,.06);
    }
    .historyRole{
      width:38px;height:38px;border-radius:11px;display:grid;place-items:center;
      background:linear-gradient(135deg, rgba(255,255,255,.09), rgba(255,255,255,.06));
      border:1px solid rgba(255,255,255,.16);
      flex:0 0 auto;
      user-select:none;
      box-shadow:0 4px 14px rgba(0,0,0,.08);
    }
    .historyRole.user{
      background:linear-gradient(135deg, rgba(168,85,247,.40), rgba(217,70,239,.38));
      border-color:rgba(168,85,247,.40);
      box-shadow:0 6px 20px rgba(168,85,247,.12);
    }
    .historyRole.assistant{
      background:linear-gradient(135deg, rgba(34,211,238,.35), rgba(59,130,246,.28));
      border-color:rgba(34,211,238,.30);
      box-shadow:0 6px 20px rgba(34,211,238,.12);
    }
    .historyBody{flex:1;min-width:0}
    .historyMeta{display:flex;align-items:center;justify-content:space-between;gap:12px;margin-bottom:7px}
    .historyMeta strong{color:var(--textBright);font-weight:900;font-size:12.5px;letter-spacing:.2px}
    .historyMeta span{color:var(--muted);font-size:11.5px;font-weight:600}
    .historyText{color:var(--text);font-size:13.5px;line-height:1.6;white-space:pre-wrap;word-break:break-word;font-weight:500}

    .toast{
      position:fixed;bottom:28px;left:50%;transform:translateX(-50%);
      padding:16px 24px;
      background:rgba(11,16,32,.96);
      border:1px solid var(--stroke);border-radius:14px;
      color:var(--text);font-size:14px;font-weight:800;
      box-shadow:0 28px 110px rgba(0,0,0,.70);
      backdrop-filter:blur(20px);
      display:none;z-index:1001;
      max-width:min(560px, calc(100% - 48px));
      text-align:center;
      animation:toastSlideUp .4s cubic-bezier(.4,0,.2,1);
    }
    @keyframes toastSlideUp{from{opacity:0;transform:translateX(-50%) translateY(40px)}to{opacity:1;transform:translateX(-50%) translateY(0)}}
    .toast.show{display:block}
    .toast.success{
      border-color:rgba(34,197,94,.50);
      background:linear-gradient(135deg, rgba(34,197,94,.20), rgba(22,163,74,.16));
      color:#86efac;
      box-shadow:0 28px 110px rgba(34,197,94,.20);
    }
    .toast.error{
      border-color:rgba(239,68,68,.50);
      background:linear-gradient(135deg, rgba(239,68,68,.20), rgba(220,38,38,.16));
      color:#fecaca;
      box-shadow:0 28px 110px rgba(239,68,68,.20);
    }
    .toast.warning{
      border-color:rgba(245,158,11,.50);
      background:linear-gradient(135deg, rgba(245,158,11,.20), rgba(217,119,6,.16));
      color:#fde68a;
      box-shadow:0 28px 110px rgba(245,158,11,.20);
    }

    ::-webkit-scrollbar{width:9px;height:9px}
    ::-webkit-scrollbar-track{background:rgba(255,255,255,.04)}
    ::-webkit-scrollbar-thumb{background:rgba(255,255,255,.18);border-radius:5px}
    ::-webkit-scrollbar-thumb:hover{background:rgba(255,255,255,.28)}

    @media (max-width: 768px){
      .sidebar{flex:0 0 100%;order:2;border-right:none;border-top:1px solid var(--stroke);max-height:44vh}
      .main{order:1}
      .container{flex-direction:column}
      .formGrid{grid-template-columns:1fr}
      .aiHelper{width:56px;height:56px;font-size:28px;right:18px;bottom:18px}
      .hintMini{display:none}
      .headerRight{gap:10px}
      .header{padding:14px 18px}
    }

    @media (prefers-reduced-motion: reduce){
      *,*::before,*::after{animation-duration:.01ms!important;transition-duration:.01ms!important}
    }

    .sr-only{
      position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;
      clip:rect(0,0,0,0);white-space:nowrap;border-width:0;
    }

    .loading{position:relative;pointer-events:none;opacity:.75}
    .loading::after{
      content:'';position:absolute;top:50%;left:50%;
      width:18px;height:18px;margin:-9px 0 0 -9px;
      border:2.5px solid transparent;border-top-color:currentColor;border-radius:50%;
      animation:spin .75s linear infinite;
    }
    @keyframes spin{to{transform:rotate(360deg)}}
  </style>
</head>

<body>
  <div class="app">
    <header class="header">
      <div class="brand" role="button" tabindex="0" id="homeBtn" aria-label="Go to welcome">
        <div class="logo" aria-hidden="true">
          <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
            <defs>
              <linearGradient id="logoGrad" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" style="stop-color:#22d3ee;stop-opacity:1" />
                <stop offset="100%" style="stop-color:#3b82f6;stop-opacity:1" />
              </linearGradient>
            </defs>
            <rect width="100" height="100" rx="18" fill="url(#logoGrad)" />
            <text x="50" y="72" font-size="62" font-weight="900" text-anchor="middle" fill="#071018" font-family="system-ui, -apple-system, sans-serif">G</text>
          </svg>
          <div class="logo-shine"></div>
        </div>
        <div class="brandtext">
          <div class="title" id="t_title">Avatar G</div>
          <div class="subtitle" id="t_subtitle">AI Workspace</div>
        </div>
      </div>

      <div class="headerRight">
        <div class="creditBadge" id="creditBadge" title="Credits balance">
          <span id="t_creditsLabel">Credits:</span> <strong id="creditNum">100</strong>
        </div>

        <button class="miniBtn" id="historyBtn" type="button">History</button>

        <button class="miniBtn" id="resetCreditsBtn" type="button" title="Reset credits (demo)">Reset</button>

        <div class="selectWrap">
          <select class="select" id="lang" aria-label="Language">
            <option value="ka" selected>KA</option>
            <option value="en">EN</option>
          </select>
        </div>
      </div>
    </header>

    <div class="container">
      <aside class="sidebar" aria-label="Services sidebar">
        <div class="sidebarTitle">
          <span id="t_services">Services</span>
          <span class="activeChip" id="activeChip" style="display:none;">ACTIVE</span>
        </div>

        <div class="serviceCard" data-service="avatar" tabindex="0" role="button" aria-label="Avatar service">
          <div class="serviceBadge">NEW</div>
          <div class="serviceTop">
            <div class="serviceIcon">ğŸ§‘â€ğŸ­</div>
            <h4 id="s_avatar">Avatar</h4>
          </div>
          <p id="sd_avatar">áƒáƒ•áƒáƒ¢áƒáƒ áƒ˜áƒ¡ áƒ¨áƒ”áƒ¥áƒ›áƒœáƒ AI-áƒ˜áƒ—</p>
          <div class="costLine"><span id="t_cost">Cost</span> <strong id="c_avatar">20</strong></div>
        </div>

        <div class="serviceCard" data-service="image" tabindex="0" role="button" aria-label="Image service">
          <div class="serviceTop">
            <div class="serviceIcon">ğŸ–¼ï¸</div>
            <h4 id="s_image">Image</h4>
          </div>
          <p id="sd_image">áƒ¤áƒáƒ¢áƒ áƒ’áƒ”áƒœáƒ”áƒ áƒáƒªáƒ˜áƒ/áƒ áƒ”áƒ“áƒáƒ¥áƒ¢áƒ˜áƒ áƒ”áƒ‘áƒ</p>
          <div class="costLine"><span id="t_cost2">Cost</span> <strong id="c_image">12</strong></div>
        </div>

        <div class="serviceCard" data-service="video" tabindex="0" role="button" aria-label="Video service">
          <div class="serviceBadge" style="background:linear-gradient(135deg, rgba(168,85,247,.24), rgba(217,70,239,.20)); border-color:rgba(168,85,247,.35); color:#c084fc;">PRO</div>
          <div class="serviceTop">
            <div class="serviceIcon">ğŸ¬</div>
            <h4 id="s_video">Video</h4>
          </div>
          <p id="sd_video">áƒ•áƒ˜áƒ“áƒ”áƒ áƒ¡áƒªáƒ”áƒœáƒáƒ áƒ˜ áƒ“áƒ áƒ¨áƒ”áƒ¥áƒ›áƒœáƒ</p>
          <div class="costLine"><span id="t_cost3">Cost</span> <strong id="c_video">25</strong></div>
        </div>

        <div class="serviceCard" data-service="voice" tabindex="0" role="button" aria-label="Voice service">
          <div class="serviceTop">
            <div class="serviceIcon">ğŸ¤</div>
            <h4 id="s_voice">Voice</h4>
          </div>
          <p id="sd_voice">áƒ®áƒ›áƒ˜áƒ¡ áƒ’áƒ”áƒœáƒ”áƒ áƒáƒªáƒ˜áƒ áƒ“áƒ áƒ™áƒšáƒáƒœáƒ˜áƒ áƒ”áƒ‘áƒ</p>
          <div class="costLine"><span id="t_cost4">Cost</span> <strong id="c_voice">18</strong></div>
        </div>

        <div class="serviceCard" data-service="music" tabindex="0" role="button" aria-label="Music service">
          <div class="serviceTop">
            <div class="serviceIcon">ğŸµ</div>
            <h4 id="s_music">Music</h4>
          </div>
          <p id="sd_music">áƒ›áƒ£áƒ¡áƒ˜áƒ™áƒ˜áƒ¡ áƒ¨áƒ”áƒ¥áƒ›áƒœáƒ AI-áƒ˜áƒ—</p>
          <div class="costLine"><span id="t_cost5">Cost</span> <strong id="c_music">10</strong></div>
        </div>

        <div class="serviceCard" data-service="text" tabindex="0" role="button" aria-label="Text service">
          <div class="serviceTop">
            <div class="serviceIcon">âœï¸</div>
            <h4 id="s_text">Text</h4>
          </div>
          <p id="sd_text">áƒ¢áƒ”áƒ¥áƒ¡áƒ¢áƒ˜áƒ¡ áƒ’áƒ”áƒœáƒ”áƒ áƒáƒªáƒ˜áƒ áƒ“áƒ áƒ áƒ”áƒ“áƒáƒ¥áƒ¢áƒ˜áƒ áƒ”áƒ‘áƒ</p>
          <div class="costLine"><span id="t_cost6">Cost</span> <strong id="c_text">6</strong></div>
        </div>
      </aside>

      <main class="main">
        <div class="chatContainer" id="chatContainer">
          <div class="emptyState" id="emptyState">
            <div class="emptyIcon">ğŸ¤–</div>
            <h2 id="t_welcome">áƒ’áƒáƒ›áƒáƒ áƒ¯áƒáƒ‘áƒ! ğŸ‘‹</h2>
            <p id="t_welcomeText">
              áƒ›áƒáƒ’áƒ”áƒ¡áƒáƒšáƒ›áƒ”áƒ‘áƒ˜áƒ— Avatar G AI Workspace-áƒ¨áƒ˜.<br/>
              áƒáƒ˜áƒ áƒ©áƒ˜áƒ”áƒ— áƒ¡áƒ”áƒ áƒ•áƒ˜áƒ¡áƒ˜ áƒ“áƒ áƒ“áƒáƒ˜áƒ¬áƒ§áƒ”áƒ— áƒ¨áƒ”áƒ¥áƒ›áƒœáƒ.
            </p>
            <div class="quickActions">
              <button class="quickBtn" data-quick="avatar" id="q_avatar">áƒ¨áƒ”áƒ¥áƒ›áƒ”áƒœáƒ˜ áƒáƒ•áƒáƒ¢áƒáƒ áƒ˜</button>
              <button class="quickBtn" data-quick="video" id="q_video">áƒ’áƒáƒáƒ™áƒ”áƒ—áƒ” áƒ•áƒ˜áƒ“áƒ”áƒ</button>
              <button class="quickBtn" data-quick="text" id="q_text">áƒ“áƒáƒ¬áƒ”áƒ áƒ” áƒ¢áƒ”áƒ¥áƒ¡áƒ¢áƒ˜</button>
            </div>
          </div>
        </div>

        <div class="inputArea">
          <div class="inputWrapper">
            <div class="inputBox">
              <div class="inputTop" id="serviceTagContainer" style="display:none;">
                <div class="serviceTag" id="activeServiceTag">
                  <span id="tagServiceName">Service</span>
                  <span class="costMini" id="tagCost">â€”</span>
                  <button type="button" id="removeServiceTag" aria-label="Remove service">âœ•</button>
                </div>
              </div>

              <div class="attachmentPills" id="attachPills" style="display:none;"></div>

              <textarea id="mainInput" placeholder="áƒ áƒáƒ¡ áƒ¨áƒ”áƒ•áƒ¥áƒ›áƒœáƒáƒ— áƒ“áƒ¦áƒ”áƒ¡? áƒáƒ¦áƒ¬áƒ”áƒ áƒ”áƒ— áƒ—áƒ¥áƒ•áƒ”áƒœáƒ˜ áƒ˜áƒ“áƒ”áƒ..." rows="1"></textarea>

              <div class="inputActions">
                <div class="leftActions">
                  <button class="iconBtn" id="attachBtn" type="button" title="Attach" aria-label="Attach files">ğŸ“</button>
                  <button class="iconBtn" id="promptBtn" type="button" title="Prompt Builder" aria-label="Open prompt builder">âœ¨</button>
                </div>
                <div class="rightActions">
                  <div class="hintMini" id="costPreview" style="display:none;">
                    <span id="t_costPreview">Cost:</span> <strong id="costPreviewNum">â€”</strong>
                  </div>
                </div>
              </div>
            </div>

            <button class="sendBtn" id="sendBtn" type="button">
              <span id="t_send">áƒ’áƒáƒ’áƒ–áƒáƒ•áƒœáƒ</span>
              <span>â†’</span>
            </button>
          </div>

          <input id="fileInput" type="file" class="sr-only" multiple />
        </div>
      </main>
    </div>

    <button class="aiHelper" id="aiHelperBtn" type="button" aria-label="AI Helper" title="AI Assistant">ğŸ¤–</button>
  </div>

  <!-- Modals (same as before with enhanced styling) -->
  <div class="overlay" id="promptOverlay" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-label="Prompt Builder">
      <div class="modalHead">
        <div class="modalTitle">
          <span style="font-size:26px;">âœ¨</span>
          <strong id="t_promptBuilder">Prompt Builder</strong>
        </div>
        <button class="closeBtn" id="promptCloseBtn" aria-label="Close">âœ•</button>
      </div>
      <div class="modalBody">
        <div class="hint" id="promptHint">áƒáƒ˜áƒ áƒ©áƒ˜áƒ”áƒ— template áƒáƒœ áƒ¨áƒ”áƒ¥áƒ›áƒ”áƒœáƒ˜áƒ— custom prompt áƒ—áƒ¥áƒ•áƒ”áƒœáƒ˜ áƒ¡áƒ”áƒ áƒ•áƒ˜áƒ¡áƒ˜áƒ¡áƒ—áƒ•áƒ˜áƒ¡.</div>

        <div class="formGrid">
          <div class="field">
            <label id="l_service">Service</label>
            <select id="promptService">
              <option value="">â€” áƒáƒ áƒ©áƒ”áƒ•áƒ â€”</option>
              <option value="avatar">Avatar</option>
              <option value="image">Image</option>
              <option value="video">Video</option>
              <option value="voice">Voice</option>
              <option value="music">Music</option>
              <option value="text">Text</option>
            </select>
          </div>

          <div class="field">
            <label id="l_style">Style / Tone</label>
            <select id="promptStyle">
              <option value="">â€” áƒáƒ áƒ©áƒ”áƒ•áƒ â€”</option>
              <option value="professional">Professional</option>
              <option value="casual">Casual</option>
              <option value="creative">Creative</option>
              <option value="technical">Technical</option>
            </select>
          </div>

          <div class="field full">
            <label id="l_custom">Custom Prompt</label>
            <textarea id="customPrompt" class="promptArea" placeholder="áƒ›áƒáƒ’: Create a 15-second Instagram Reel with upbeat music..."></textarea>
          </div>
        </div>

        <div style="margin:20px 0;">
          <label style="margin-bottom:12px; display:block; font-size:13px; font-weight:900;" id="l_templates">Templates</label>
          <div class="templateList" id="templateList"></div>
        </div>

        <div class="btnRow">
          <button class="btn btnSecondary" id="promptCancelBtn">Cancel</button>
          <button class="btn btnPrimary" id="promptUseBtn">Use Prompt</button>
        </div>
      </div>
    </div>
  </div>

  <div class="overlay" id="helperOverlay" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-label="AI Helper">
      <div class="modalHead">
        <div class="modalTitle">
          <span style="font-size:26px;">ğŸ¤–</span>
          <strong id="t_aiHelper">AI Helper</strong>
        </div>
        <button class="closeBtn" id="helperCloseBtn" aria-label="Close">âœ•</button>
      </div>
      <div class="modalBody">
        <div class="hint" id="helperHint">áƒ’áƒáƒ›áƒáƒ áƒ¯áƒáƒ‘áƒ! áƒ›áƒ” áƒ•áƒáƒ  Avatar G-áƒ˜áƒ¡ AI áƒáƒ¡áƒ˜áƒ¡áƒ¢áƒ”áƒœáƒ¢áƒ˜. áƒ’áƒ”áƒ®áƒ›áƒáƒ áƒ”áƒ‘áƒ˜áƒ— áƒ˜áƒ“áƒ”áƒ”áƒ‘áƒ˜áƒ¡ áƒ’áƒ”áƒœáƒ”áƒ áƒ˜áƒ áƒ”áƒ‘áƒáƒ¡áƒ áƒ“áƒ prompt-áƒ”áƒ‘áƒ˜áƒ¡ áƒ¨áƒ”áƒ¥áƒ›áƒœáƒáƒ¨áƒ˜.</div>

        <div class="formGrid">
          <div class="field full">
            <label id="l_question">áƒ áƒáƒ¨áƒ˜ áƒ’áƒ­áƒ˜áƒ áƒ“áƒ”áƒ‘áƒáƒ— áƒ“áƒáƒ®áƒ›áƒáƒ áƒ”áƒ‘áƒ?</label>
            <textarea id="helperQuestion" class="promptArea" placeholder="áƒ›áƒáƒ’: áƒ áƒáƒ’áƒáƒ  áƒ¨áƒ”áƒ•áƒ¥áƒ›áƒœáƒ áƒ”áƒ¤áƒ”áƒ¥áƒ¢áƒ£áƒ áƒ˜ Instagram Reel?"></textarea>
          </div>
        </div>

        <div class="btnRow">
          <button class="btn btnSecondary" id="helperCancelBtn">Close</button>
          <button class="btn btnPrimary" id="helperAskBtn">Ask AI</button>
        </div>

        <div id="helperResponse" style="margin-top:20px; display:none;">
          <label style="margin-bottom:12px; display:block; font-weight:900; font-size:13px;">AI Response:</label>
          <div style="padding:16px; background:linear-gradient(135deg, rgba(34,211,238,.12), rgba(59,130,246,.08)); border: 1px solid rgba(34,211,238,.28); border-radius: 14px; line-height: 1.7; font-size: 14px; box-shadow:0 6px 24px rgba(34,211,238,.10);">
            <div id="helperResponseText"></div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <div class="overlay" id="historyOverlay" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-label="History">
      <div class="modalHead">
        <div class="modalTitle">
          <span style="font-size:26px;">ğŸ—‚ï¸</span>
          <strong id="t_history">History</strong>
        </div>
        <button class="closeBtn" id="historyCloseBtn" aria-label="Close">âœ•</button>
      </div>
      <div class="modalBody">
        <div class="hint" id="historyHint">áƒáƒ¥ áƒœáƒáƒ®áƒáƒ•áƒ— áƒ©áƒáƒ¢áƒ˜áƒ¡ áƒ˜áƒ¡áƒ¢áƒáƒ áƒ˜áƒáƒ¡ (localStorage). áƒ¨áƒ”áƒ’áƒ˜áƒ«áƒšáƒ˜áƒáƒ— áƒ’áƒáƒ¡áƒ£áƒ¤áƒ—áƒáƒ•áƒ”áƒ‘áƒ áƒáƒœ áƒ”áƒ¥áƒ¡áƒáƒáƒ áƒ¢áƒ˜.</div>

        <div class="btnRow" style="justify-content:flex-start; margin-top:0; margin-bottom:16px;">
          <button class="btn btnSecondary" id="exportBtn">Export JSON</button>
          <button class="btn btnDanger" id="clearBtn">Clear History</button>
        </div>

        <div class="historyList" id="historyList"></div>

        <div class="btnRow">
          <button class="btn btnSecondary" id="historyCancelBtn">Close</button>
        </div>
      </div>
    </div>
  </div>

  <div class="toast" id="toast" role="alert">Done</div>

  <script>
    // [Same JavaScript as before - keeping it identical for functionality]
    const STORE_MESSAGES = "avatar_g_messages_v2";
    const STORE_CREDITS  = "avatar_g_credits_v2";
    const STORE_LANG     = "avatar_g_lang_v2";
    const STORE_SERVICE  = "avatar_g_active_service_v2";

    const CREDIT_DEFAULT = 100;
    const CREDIT_COST = { avatar: 20, image: 12, video: 25, voice: 18, music: 10, text: 6 };

    const safeJSONParse = (s, fallback) => { try { return JSON.parse(s); } catch { return fallback; } };

    function getCredits() {
      const v = Number(localStorage.getItem(STORE_CREDITS));
      return Number.isFinite(v) && v >= 0 ? v : CREDIT_DEFAULT;
    }
    function setCredits(v) {
      localStorage.setItem(STORE_CREDITS, String(Math.max(0, Math.floor(v))));
      updateCreditsDisplay();
    }
    function updateCreditsDisplay() {
      document.getElementById("creditNum").textContent = getCredits();
    }

    function initStorage() {
      if (!localStorage.getItem(STORE_MESSAGES)) localStorage.setItem(STORE_MESSAGES, JSON.stringify([]));
      if (!localStorage.getItem(STORE_CREDITS))  localStorage.setItem(STORE_CREDITS, String(CREDIT_DEFAULT));
      if (!localStorage.getItem(STORE_LANG))     localStorage.setItem(STORE_LANG, "ka");
      if (!localStorage.getItem(STORE_SERVICE))  localStorage.setItem(STORE_SERVICE, "");
    }

    const I18N = {
      ka: {
        title: "Avatar G",
        subtitle: "AI Workspace",
        services: "áƒ¡áƒ”áƒ áƒ•áƒ˜áƒ¡áƒ”áƒ‘áƒ˜",
        cost: "Cost",
        creditsLabel: "Credits:",
        history: "History",
        historyHint: "áƒáƒ¥ áƒœáƒáƒ®áƒáƒ•áƒ— áƒ©áƒáƒ¢áƒ˜áƒ¡ áƒ˜áƒ¡áƒ¢áƒáƒ áƒ˜áƒáƒ¡ (localStorage). áƒ¨áƒ”áƒ’áƒ˜áƒ«áƒšáƒ˜áƒáƒ— áƒ’áƒáƒ¡áƒ£áƒ¤áƒ—áƒáƒ•áƒ”áƒ‘áƒ áƒáƒœ áƒ”áƒ¥áƒ¡áƒáƒáƒ áƒ¢áƒ˜.",
        export: "Export JSON",
        clear: "Clear History",
        reset: "Reset",
        s_avatar: "Avatar",
        sd_avatar: "áƒáƒ•áƒáƒ¢áƒáƒ áƒ˜áƒ¡ áƒ¨áƒ”áƒ¥áƒ›áƒœáƒ AI-áƒ˜áƒ—",
        s_image: "Image",
        sd_image: "áƒ¤áƒáƒ¢áƒ áƒ’áƒ”áƒœáƒ”áƒ áƒáƒªáƒ˜áƒ/áƒ áƒ”áƒ“áƒáƒ¥áƒ¢áƒ˜áƒ áƒ”áƒ‘áƒ",
        s_video: "Video",
        sd_video: "áƒ•áƒ˜áƒ“áƒ”áƒ áƒ¡áƒªáƒ”áƒœáƒáƒ áƒ˜ áƒ“áƒ áƒ¨áƒ”áƒ¥áƒ›áƒœáƒ",
        s_voice: "Voice",
        sd_voice: "áƒ®áƒ›áƒ˜áƒ¡ áƒ’áƒ”áƒœáƒ”áƒ áƒáƒªáƒ˜áƒ áƒ“áƒ áƒ™áƒšáƒáƒœáƒ˜áƒ áƒ”áƒ‘áƒ",
        s_music: "Music",
        sd_music: "áƒ›áƒ£áƒ¡áƒ˜áƒ™áƒ˜áƒ¡ áƒ¨áƒ”áƒ¥áƒ›áƒœáƒ AI-áƒ˜áƒ—",
        s_text: "Text",
        sd_text: "áƒ¢áƒ”áƒ¥áƒ¡áƒ¢áƒ˜áƒ¡ áƒ’áƒ”áƒœáƒ”áƒ áƒáƒªáƒ˜áƒ áƒ“áƒ áƒ áƒ”áƒ“áƒáƒ¥áƒ¢áƒ˜áƒ áƒ”áƒ‘áƒ",
        welcome: "áƒ’áƒáƒ›áƒáƒ áƒ¯áƒáƒ‘áƒ! ğŸ‘‹",
        welcomeText: "áƒ›áƒáƒ’áƒ”áƒ¡áƒáƒšáƒ›áƒ”áƒ‘áƒ˜áƒ— Avatar G AI Workspace-áƒ¨áƒ˜.<br/>áƒáƒ˜áƒ áƒ©áƒ˜áƒ”áƒ— áƒ¡áƒ”áƒ áƒ•áƒ˜áƒ¡áƒ˜ áƒ“áƒ áƒ“áƒáƒ˜áƒ¬áƒ§áƒ”áƒ— áƒ¨áƒ”áƒ¥áƒ›áƒœáƒ.",
        q_avatar: "áƒ¨áƒ”áƒ¥áƒ›áƒ”áƒœáƒ˜ áƒáƒ•áƒáƒ¢áƒáƒ áƒ˜",
        q_video: "áƒ’áƒáƒáƒ™áƒ”áƒ—áƒ” áƒ•áƒ˜áƒ“áƒ”áƒ",
        q_text: "áƒ“áƒáƒ¬áƒ”áƒ áƒ” áƒ¢áƒ”áƒ¥áƒ¡áƒ¢áƒ˜",
        send: "áƒ’áƒáƒ’áƒ–áƒáƒ•áƒœáƒ",
        costPreview: "Cost:",
        promptBuilder: "Prompt Builder",
        promptHint: "áƒáƒ˜áƒ áƒ©áƒ˜áƒ”áƒ— template áƒáƒœ áƒ¨áƒ”áƒ¥áƒ›áƒ”áƒœáƒ˜áƒ— custom prompt áƒ—áƒ¥áƒ•áƒ”áƒœáƒ˜ áƒ¡áƒ”áƒ áƒ•áƒ˜áƒ¡áƒ˜áƒ¡áƒ—áƒ•áƒ˜áƒ¡.",
        aiHelper: "AI Helper",
        helperHint: "áƒ’áƒáƒ›áƒáƒ áƒ¯áƒáƒ‘áƒ! áƒ›áƒ” áƒ•áƒáƒ  Avatar G-áƒ˜áƒ¡ AI áƒáƒ¡áƒ˜áƒ¡áƒ¢áƒ”áƒœáƒ¢áƒ˜. áƒ’áƒ”áƒ®áƒ›áƒáƒ áƒ”áƒ‘áƒ˜áƒ— áƒ˜áƒ“áƒ”áƒ”áƒ‘áƒ˜áƒ¡ áƒ’áƒ”áƒœáƒ”áƒ áƒ˜áƒ áƒ”áƒ‘áƒáƒ¡áƒ áƒ“áƒ prompt-áƒ”áƒ‘áƒ˜áƒ¡ áƒ¨áƒ”áƒ¥áƒ›áƒœáƒáƒ¨áƒ˜.",
        l_service: "Service",
        l_style: "Style / Tone",
        l_custom: "Custom Prompt",
        l_templates: "Templates",
        l_question: "áƒ áƒáƒ¨áƒ˜ áƒ’áƒ­áƒ˜áƒ áƒ“áƒ”áƒ‘áƒáƒ— áƒ“áƒáƒ®áƒ›áƒáƒ áƒ”áƒ‘áƒ?",
        inputPlaceholder: "áƒ áƒáƒ¡ áƒ¨áƒ”áƒ•áƒ¥áƒ›áƒœáƒáƒ— áƒ“áƒ¦áƒ”áƒ¡? áƒáƒ¦áƒ¬áƒ”áƒ áƒ”áƒ— áƒ—áƒ¥áƒ•áƒ”áƒœáƒ˜ áƒ˜áƒ“áƒ”áƒ...",
        assistantName: "Avatar G AI",
        userName: "áƒ—áƒ¥áƒ•áƒ”áƒœ",
        pickServiceWarn: "âš ï¸ áƒ’áƒ—áƒ®áƒáƒ•áƒ— áƒáƒ˜áƒ áƒ©áƒ˜áƒáƒ— áƒ¡áƒ”áƒ áƒ•áƒ˜áƒ¡áƒ˜",
        notEnoughCredits: "âš ï¸ áƒáƒ  áƒ’áƒáƒ¥áƒ•áƒ— áƒ¡áƒáƒ™áƒ›áƒáƒ áƒ˜áƒ¡áƒ˜ áƒ™áƒ áƒ”áƒ“áƒ˜áƒ¢áƒ”áƒ‘áƒ˜",
        promptEmpty: "âš ï¸ áƒ¨áƒ”áƒ˜áƒ§áƒ•áƒáƒœáƒ”áƒ— prompt",
        promptAdded: "âœ… Prompt áƒ“áƒáƒ”áƒ›áƒáƒ¢áƒ",
        active: "ACTIVE",
        attached: "Attached",
        serviceActive: (s)=>`âœ… ${String(s).toUpperCase()} áƒáƒ¥áƒ¢áƒ˜áƒ£áƒ áƒ˜áƒ`,
        created: (c)=>`âœ… áƒ¨áƒ”áƒ¥áƒ›áƒœáƒ˜áƒšáƒ˜áƒ! Credits: ${c}`,
        historyEmpty: "áƒ˜áƒ¡áƒ¢áƒáƒ áƒ˜áƒ áƒªáƒáƒ áƒ˜áƒ”áƒšáƒ˜áƒ."
      },
      en: {
        title: "Avatar G",
        subtitle: "AI Workspace",
        services: "Services",
        cost: "Cost",
        creditsLabel: "Credits:",
        history: "History",
        historyHint: "Here is your chat history (localStorage). You can clear it or export.",
        export: "Export JSON",
        clear: "Clear History",
        reset: "Reset",
        s_avatar: "Avatar",
        sd_avatar: "Create AI avatars",
        s_image: "Image",
        sd_image: "Generate & edit images",
        s_video: "Video",
        sd_video: "Video scripts & creation",
        s_voice: "Voice",
        sd_voice: "Voice generation & cloning",
        s_music: "Music",
        sd_music: "AI music creation",
        s_text: "Text",
        sd_text: "Text generation & editing",
        welcome: "Hello! ğŸ‘‹",
        welcomeText: "Welcome to Avatar G AI Workspace.<br/>Choose a service and start creating.",
        q_avatar: "Create Avatar",
        q_video: "Make Video",
        q_text: "Write Text",
        send: "Send",
        costPreview: "Cost:",
        promptBuilder: "Prompt Builder",
        promptHint: "Choose a template or create a custom prompt for your service.",
        aiHelper: "AI Helper",
        helperHint: "Hi! I'm Avatar G's AI assistant. I can help you with ideas and prompt creation.",
        l_service: "Service",
        l_style: "Style / Tone",
        l_custom: "Custom Prompt",
        l_templates: "Templates",
        l_question: "What do you need help with?",
        inputPlaceholder: "What shall we create today? Describe your idea...",
        assistantName: "Avatar G AI",
        userName: "You",
        pickServiceWarn: "âš ï¸ Please select a service",
        notEnoughCredits: "âš ï¸ Not enough credits",
        promptEmpty: "âš ï¸ Enter a prompt",
        promptAdded: "âœ… Prompt added",
        active: "ACTIVE",
        attached: "Attached",
        serviceActive: (s)=>`âœ… ${String(s).toUpperCase()} active`,
        created: (c)=>`âœ… Done! Credits: ${c}`,
        historyEmpty: "History is empty."
      }
    };

    const TEMPLATES = {
      avatar: [
        { name: "Professional Avatar", prompt: "Create a professional talking avatar for business presentation, neutral background, formal attire" },
        { name: "Social Media Avatar", prompt: "Casual talking avatar for Instagram/TikTok, trendy background, energetic vibe" },
        { name: "Product Demo Avatar", prompt: "Avatar presenting a product, enthusiastic tone, demonstration style" }
      ],
      image: [
        { name: "Social Post", prompt: "Create an eye-catching social media image, vibrant colors, modern design" },
        { name: "Product Photo", prompt: "Professional product photography, clean background, studio lighting" },
        { name: "Banner Design", prompt: "Web banner design, brand colors, call-to-action focus" }
      ],
      video: [
        { name: "Instagram Reel", prompt: "15-second Instagram Reel, fast-paced, trending music, attention-grabbing" },
        { name: "Tutorial Video", prompt: "Step-by-step tutorial video, clear instructions, educational tone" },
        { name: "Promo Video", prompt: "30-second promotional video, highlight key features, persuasive messaging" }
      ],
      voice: [
        { name: "Voiceover - Professional", prompt: "Professional voiceover, clear articulation, authoritative tone" },
        { name: "Voiceover - Friendly", prompt: "Warm and friendly voiceover, conversational style, approachable tone" },
        { name: "Narration", prompt: "Documentary-style narration, engaging storytelling, measured pace" }
      ],
      music: [
        { name: "Upbeat Background", prompt: "Upbeat background music, energetic, positive vibes, instrumental" },
        { name: "Calm Ambient", prompt: "Calm ambient music, relaxing atmosphere, subtle melody" },
        { name: "Corporate", prompt: "Corporate background music, professional, motivating, modern" }
      ],
      text: [
        { name: "Social Caption", prompt: "Engaging social media caption, emoji usage, call-to-action, hashtags" },
        { name: "Email Copy", prompt: "Professional email copy, clear structure, persuasive content" },
        { name: "Ad Copy", prompt: "Attention-grabbing ad copy, benefits-focused, strong CTA" }
      ]
    };

    let currentLang = "ka";
    let activeService = null;
    let messages = [];
    let attachments = [];

    const langSel = document.getElementById("lang");
    const chatContainer = document.getElementById("chatContainer");
    const emptyState = document.getElementById("emptyState");
    const mainInput = document.getElementById("mainInput");
    const sendBtn = document.getElementById("sendBtn");

    const serviceTagContainer = document.getElementById("serviceTagContainer");
    const tagServiceName = document.getElementById("tagServiceName");
    const tagCost = document.getElementById("tagCost");
    const removeServiceTag = document.getElementById("removeServiceTag");

    const costPreview = document.getElementById("costPreview");
    const costPreviewNum = document.getElementById("costPreviewNum");

    const attachBtn = document.getElementById("attachBtn");
    const fileInput = document.getElementById("fileInput");
    const attachPills = document.getElementById("attachPills");

    const promptOverlay = document.getElementById("promptOverlay");
    const promptBtn = document.getElementById("promptBtn");
    const promptCloseBtn = document.getElementById("promptCloseBtn");
    const promptCancelBtn = document.getElementById("promptCancelBtn");
    const promptUseBtn = document.getElementById("promptUseBtn");
    const promptService = document.getElementById("promptService");
    const promptStyle = document.getElementById("promptStyle");
    const customPrompt = document.getElementById("customPrompt");
    const templateList = document.getElementById("templateList");

    const helperOverlay = document.getElementById("helperOverlay");
    const aiHelperBtn = document.getElementById("aiHelperBtn");
    const helperCloseBtn = document.getElementById("helperCloseBtn");
    const helperCancelBtn = document.getElementById("helperCancelBtn");
    const helperAskBtn = document.getElementById("helperAskBtn");
    const helperQuestion = document.getElementById("helperQuestion");
    const helperResponse = document.getElementById("helperResponse");
    const helperResponseText = document.getElementById("helperResponseText");

    const historyBtn = document.getElementById("historyBtn");
    const historyOverlay = document.getElementById("historyOverlay");
    const historyCloseBtn = document.getElementById("historyCloseBtn");
    const historyCancelBtn = document.getElementById("historyCancelBtn");
    const historyList = document.getElementById("historyList");
    const exportBtn = document.getElementById("exportBtn");
    const clearBtn = document.getElementById("clearBtn");

    const homeBtn = document.getElementById("homeBtn");
    const activeChip = document.getElementById("activeChip");

    const resetCreditsBtn = document.getElementById("resetCreditsBtn");
    const toast = document.getElementById("toast");

    function tr() { return I18N[currentLang] || I18N.ka; }

    function applyLang(code) {
      currentLang = code;
      localStorage.setItem(STORE_LANG, code);
      const t = tr();

      document.getElementById("t_title").textContent = t.title;
      document.getElementById("t_subtitle").textContent = t.subtitle;

      document.getElementById("t_services").textContent = t.services;
      ["t_cost","t_cost2","t_cost3","t_cost4","t_cost5","t_cost6"].forEach(id=>document.getElementById(id).textContent = t.cost);

      document.getElementById("t_creditsLabel").textContent = t.creditsLabel;
      document.getElementById("historyBtn").textContent = t.history;
      document.getElementById("resetCreditsBtn").textContent = t.reset;

      ["avatar","image","video","voice","music","text"].forEach(s => {
        document.getElementById(`s_${s}`).textContent = t[`s_${s}`];
        document.getElementById(`sd_${s}`).textContent = t[`sd_${s}`];
      });

      document.getElementById("t_welcome").textContent = t.welcome;
      document.getElementById("t_welcomeText").innerHTML = t.welcomeText;
      document.getElementById("q_avatar").textContent = t.q_avatar;
      document.getElementById("q_video").textContent = t.q_video;
      document.getElementById("q_text").textContent = t.q_text;

      document.getElementById("t_send").textContent = t.send;
      document.getElementById("t_costPreview").textContent = t.costPreview;

      mainInput.placeholder = t.inputPlaceholder;

      document.getElementById("t_promptBuilder").textContent = t.promptBuilder;
      document.getElementById("promptHint").textContent = t.promptHint;

      document.getElementById("t_aiHelper").textContent = t.aiHelper;
      document.getElementById("helperHint").textContent = t.helperHint;

      document.getElementById("l_service").textContent = t.l_service;
      document.getElementById("l_style").textContent = t.l_style;
      document.getElementById("l_custom").textContent = t.l_custom;
      document.getElementById("l_templates").textContent = t.l_templates;
      document.getElementById("l_question").textContent = t.l_question;

      document.getElementById("t_history").textContent = t.history;
      document.getElementById("historyHint").textContent = t.historyHint;
      exportBtn.textContent = t.export;
      clearBtn.textContent = t.clear;
      historyCancelBtn.textContent = "Close";

      activeChip.textContent = t.active;

      if (historyOverlay.classList.contains("show")) renderHistory();
      rerenderChatFromState(false);
      refreshCostUI();
    }

    function refreshCostUI() {
      if (!activeService) {
        costPreview.style.display = "none";
        activeChip.style.display = "none";
        return;
      }
      const cost = CREDIT_COST[activeService] || 0;
      costPreview.style.display = "flex";
      costPreviewNum.textContent = cost;
      activeChip.style.display = "inline-flex";
    }

    function setActiveService(service) {
      activeService = service || null;
      localStorage.setItem(STORE_SERVICE, activeService || "");

      document.querySelectorAll(".serviceCard").forEach(card => {
        card.classList.toggle("active", card.dataset.service === activeService);
      });

      if (activeService) {
        const cost = CREDIT_COST[activeService] || 0;
        serviceTagContainer.style.display = "flex";
        tagServiceName.textContent = String(activeService).toUpperCase();
        tagCost.textContent = `${cost}`;
        refreshCostUI();
        mainInput.focus();
      } else {
        serviceTagContainer.style.display = "none";
        attachments = [];
        renderAttachments();
        refreshCostUI();
      }
    }

    function formatBytes(bytes) {
      if (!Number.isFinite(bytes) || bytes <= 0) return "0 B";
      const units = ["B","KB","MB","GB"];
      let i = 0, v = bytes;
      while (v >= 1024 && i < units.length-1) { v /= 1024; i++; }
      return `${v.toFixed(v >= 10 || i===0 ? 0 : 1)} ${units[i]}`;
    }

    function renderAttachments() {
      if (!attachments.length) {
        attachPills.style.display = "none";
        attachPills.innerHTML = "";
        return;
      }
      attachPills.style.display = "flex";
      attachPills.innerHTML = "";
      attachments.forEach((a, idx) => {
        const pill = document.createElement("div");
        pill.className = "pill";
        const name = document.createElement("div");
        name.style.overflow = "hidden";
        name.style.textOverflow = "ellipsis";
        name.style.whiteSpace = "nowrap";
        name.textContent = a.name;

        const size = document.createElement("span");
        size.textContent = formatBytes(a.size);

        const x = document.createElement("button");
        x.type = "button";
        x.setAttribute("aria-label", "Remove attachment");
        x.textContent = "âœ•";
        x.addEventListener("click", () => {
          attachments.splice(idx, 1);
          renderAttachments();
        });

        pill.appendChild(name);
        pill.appendChild(size);
        pill.appendChild(x);
        attachPills.appendChild(pill);
      });
    }

    function addMessage(role, content, files = []) {
      const msg = {
        role,
        content,
        files: (files || []).map(f => ({ name: f.name, size: f.size })),
        timestamp: new Date().toISOString()
      };
      messages.push(msg);
      localStorage.setItem(STORE_MESSAGES, JSON.stringify(messages));
      renderMessageToDOM(msg);
      chatContainer.scrollTop = chatContainer.scrollHeight;
    }

    function renderMessageToDOM(msg) {
      const t = tr();
      const messageEl = document.createElement("div");
      messageEl.className = `message ${msg.role}`;

      const avatar = document.createElement("div");
      avatar.className = "messageAvatar";
      avatar.textContent = msg.role === "user" ? "ğŸ‘¤" : "ğŸ¤–";

      const contentDiv = document.createElement("div");
      contentDiv.className = "messageContent";

      const meta = document.createElement("div");
      meta.className = "messageMeta";

      const name = document.createElement("span");
      name.className = "messageName";
      name.textContent = msg.role === "user" ? t.userName : t.assistantName;

      const time = document.createElement("span");
      time.className = "messageTime";
      time.textContent = new Date(msg.timestamp).toLocaleTimeString();

      meta.appendChild(name);
      meta.appendChild(time);

      const text = document.createElement("div");
      text.className = "messageText";
      text.textContent = msg.content;

      contentDiv.appendChild(meta);
      contentDiv.appendChild(text);

      if (msg.files && msg.files.length) {
        const list = document.createElement("div");
        list.className = "attachmentPills";
        msg.files.forEach(f => {
          const pill = document.createElement("div");
          pill.className = "pill";
          const fn = document.createElement("div");
          fn.style.overflow = "hidden";
          fn.style.textOverflow = "ellipsis";
          fn.style.whiteSpace = "nowrap";
          fn.textContent = f.name;
          const fs = document.createElement("span");
          fs.textContent = formatBytes(f.size);
          pill.appendChild(fn);
          pill.appendChild(fs);
          list.appendChild(pill);
        });
        contentDiv.appendChild(list);
      }

      messageEl.appendChild(avatar);
      messageEl.appendChild(contentDiv);

      if (emptyState.style.display !== "none") emptyState.style.display = "none";
      chatContainer.appendChild(messageEl);
    }

    function rerenderChatFromState(scrollToBottom = true) {
      chatContainer.innerHTML = "";
      chatContainer.appendChild(emptyState);
      if (!messages.length) {
        emptyState.style.display = "";
        return;
      }
      emptyState.style.display = "none";
      messages.forEach(m => renderMessageToDOM(m));
      if (scrollToBottom) chatContainer.scrollTop = chatContainer.scrollHeight;
    }

    function generateAIResponse(service, userText) {
      const t = tr();
      const responses = {
        avatar: `${t.assistantName}: ${currentLang === "ka" ? "áƒ¨áƒ”áƒ¥áƒ›áƒœáƒ˜áƒ¡ áƒáƒ•áƒáƒ¢áƒáƒ áƒ¡ áƒ¨áƒ”áƒœáƒ˜ áƒ›áƒáƒ—áƒ®áƒáƒ•áƒœáƒ˜áƒ—" : "Will create an avatar for your request"}: "${userText}".`,
        image: `${t.assistantName}: ${currentLang === "ka" ? "áƒáƒ›áƒ–áƒáƒ“áƒ”áƒ‘áƒ¡ áƒ¤áƒáƒ¢áƒáƒ¡" : "Preparing an image"}: "${userText}".`,
        video: `${t.assistantName}: ${currentLang === "ka" ? "áƒ¥áƒ›áƒœáƒ˜áƒ¡ áƒ•áƒ˜áƒ“áƒ”áƒáƒ¡ áƒ—áƒ¥áƒ•áƒ”áƒœáƒ˜ áƒ˜áƒ“áƒ”áƒ˜áƒ—" : "Creating a video from your idea"}: "${userText}".`,
        voice: `${t.assistantName}: ${currentLang === "ka" ? "áƒ’áƒ”áƒœáƒ”áƒ áƒ˜áƒ áƒ”áƒ‘áƒ¡ áƒ®áƒ›áƒáƒ¡" : "Generating voice"}: "${userText}".`,
        music: `${t.assistantName}: ${currentLang === "ka" ? "áƒ¥áƒ›áƒœáƒ˜áƒ¡ áƒ›áƒ£áƒ¡áƒ˜áƒ™áƒáƒ¡" : "Creating music"}: "${userText}".`,
        text: `${t.assistantName}: ${currentLang === "ka" ? "áƒ¬áƒ”áƒ áƒ¡ áƒ¢áƒ”áƒ¥áƒ¡áƒ¢áƒ¡" : "Writing text"}: "${userText}".`
      };
      return responses[service] || `${t.assistantName} is working on your request.`;
    }

    function handleSend() {
      const text = mainInput.value.trim();
      if (!text) return;

      const t = tr();

      if (!activeService) {
        toastMsg(t.pickServiceWarn, "warning");
        return;
      }

      const credits = getCredits();
      const cost = CREDIT_COST[activeService] || 0;
      if (credits < cost) {
        toastMsg(t.notEnoughCredits, "warning");
        return;
      }

      const filesToAttach = attachments.slice();
      addMessage("user", text, filesToAttach);

      mainInput.value = "";
      mainInput.style.height = "auto";
      attachments = [];
      renderAttachments();

      sendBtn.disabled = true;
      sendBtn.classList.add("loading");

      setTimeout(() => {
        const response = generateAIResponse(activeService, text);
        addMessage("assistant", response);
        setCredits(credits - cost);
        sendBtn.disabled = false;
        sendBtn.classList.remove("loading");
        toastMsg(t.created(getCredits()), "success");
      }, 950);
    }

    function openPromptBuilder() {
      promptOverlay.classList.add("show");
      promptOverlay.setAttribute("aria-hidden","false");
      if (activeService) {
        promptService.value = activeService;
        renderTemplates(activeService);
      } else {
        renderTemplates(promptService.value);
      }
      setTimeout(() => customPrompt.focus(), 70);
    }
    function closePromptBuilder() {
      promptOverlay.classList.remove("show");
      promptOverlay.setAttribute("aria-hidden","true");
    }
    function renderTemplates(service) {
      templateList.innerHTML = "";
      if (!service || !TEMPLATES[service]) return;

      TEMPLATES[service].forEach(tpl => {
        const item = document.createElement("button");
        item.type = "button";
        item.className = "templateItem";
        item.innerHTML = `
          <div style="flex:1; text-align:left;">
            <strong></strong>
            <p></p>
          </div>
        `;
        item.querySelector("strong").textContent = tpl.name;
        item.querySelector("p").textContent = tpl.prompt;
        item.addEventListener("click", () => { customPrompt.value = tpl.prompt; });
        templateList.appendChild(item);
      });
    }

    function usePrompt() {
      const t = tr();
      const prompt = customPrompt.value.trim();
      if (!prompt) {
        toastMsg(t.promptEmpty, "warning");
        return;
      }

      const style = promptStyle.value;
      const styled =
        style
          ? `Style/Tone: ${style}\n\n${prompt}`
          : prompt;

      mainInput.value = styled;

      if (promptService.value) setActiveService(promptService.value);

      closePromptBuilder();
      toastMsg(t.promptAdded, "success");
      mainInput.focus();
    }

    function openHelper() {
      helperOverlay.classList.add("show");
      helperOverlay.setAttribute("aria-hidden","false");
      helperResponse.style.display = "none";
      helperQuestion.value = "";
      setTimeout(() => helperQuestion.focus(), 70);
    }
    function closeHelper() {
      helperOverlay.classList.remove("show");
      helperOverlay.setAttribute("aria-hidden","true");
    }
    function askHelper() {
      const question = helperQuestion.value.trim();
      const t = tr();
      if (!question) {
        toastMsg(t.promptEmpty, "warning");
        return;
      }

      helperAskBtn.classList.add("loading");
      helperAskBtn.disabled = true;

      setTimeout(() => {
        const answer =
          currentLang === "ka"
            ? `áƒ›áƒáƒ“áƒšáƒáƒ‘áƒ áƒ™áƒ˜áƒ—áƒ®áƒ•áƒ˜áƒ¡áƒ—áƒ•áƒ˜áƒ¡! "${question}"\n\náƒ¡áƒ¬áƒ áƒáƒ¤áƒ˜ áƒ©áƒ”áƒ™áƒšáƒ˜áƒ¡áƒ¢áƒ˜:\n1) áƒ›áƒ˜áƒ–áƒáƒœáƒ˜ + áƒáƒ£áƒ“áƒ˜áƒ¢áƒáƒ áƒ˜áƒ\n2) áƒ áƒ áƒ¨áƒ”áƒ“áƒ”áƒ’áƒ˜ áƒ’áƒ˜áƒœáƒ“áƒ (áƒ¤áƒáƒ áƒ›áƒáƒ¢áƒ˜/áƒ¡áƒ˜áƒ’áƒ áƒ«áƒ”)\n3) Style/Tone (Professional/Casual/Creative/Technical)\n4) Constraints (áƒ”áƒœáƒ, áƒ“áƒ áƒ, áƒáƒšáƒáƒ¢áƒ¤áƒáƒ áƒ›áƒ)\n5) Reference (áƒ›áƒáƒ’áƒáƒšáƒ˜áƒ—áƒ˜/áƒ‘áƒ áƒ”áƒœáƒ“áƒ˜)\n\náƒáƒ®áƒšáƒ áƒ’áƒáƒ®áƒ¡áƒ”áƒœáƒ˜ Prompt Builder âœ¨ áƒ“áƒ áƒáƒ˜áƒ áƒ©áƒ˜áƒ” template â€” áƒ¨áƒ”áƒ›áƒ“áƒ”áƒ’ áƒ“áƒáƒ•áƒ®áƒ•áƒ”áƒ¬áƒáƒ— áƒ”áƒ áƒ—áƒáƒ“.`
            : `Thanks! "${question}"\n\nQuick checklist:\n1) Goal + audience\n2) Desired output (format/length)\n3) Style/Tone\n4) Constraints (language, platform)\n5) Reference\n\nOpen Prompt Builder âœ¨, pick a template, then we refine together.`;

        helperResponseText.textContent = answer;
        helperResponse.style.display = "block";
        helperAskBtn.classList.remove("loading");
        helperAskBtn.disabled = false;
      }, 900);
    }

    function openHistory() {
      historyOverlay.classList.add("show");
      historyOverlay.setAttribute("aria-hidden","false");
      renderHistory();
    }
    function closeHistory() {
      historyOverlay.classList.remove("show");
      historyOverlay.setAttribute("aria-hidden","true");
    }
    function renderHistory() {
      const t = tr();
      historyList.innerHTML = "";
      if (!messages.length) {
        const div = document.createElement("div");
        div.className = "hint";
        div.textContent = t.historyEmpty;
        historyList.appendChild(div);
        return;
      }

      messages.slice().reverse().forEach(m => {
        const item = document.createElement("div");
        item.className = "historyItem";

        const role = document.createElement("div");
        role.className = `historyRole ${m.role}`;
        role.textContent = m.role === "user" ? "ğŸ‘¤" : "ğŸ¤–";

        const body = document.createElement("div");
        body.className = "historyBody";

        const meta = document.createElement("div");
        meta.className = "historyMeta";

        const who = document.createElement("strong");
        who.textContent = m.role === "user" ? t.userName : t.assistantName;

        const when = document.createElement("span");
        when.textContent = new Date(m.timestamp).toLocaleString();

        meta.appendChild(who);
        meta.appendChild(when);

        const text = document.createElement("div");
        text.className = "historyText";
        text.textContent = m.content;

        body.appendChild(meta);
        body.appendChild(text);

        if (m.files && m.files.length) {
          const filesLine = document.createElement("div");
          filesLine.style.marginTop = "12px";
          filesLine.style.color = "var(--muted)";
          filesLine.style.fontSize = "12.5px";
          filesLine.textContent = `${t.attached}: ${m.files.map(f => f.name).join(", ")}`;
          body.appendChild(filesLine);
        }

        item.appendChild(role);
        item.appendChild(body);
        historyList.appendChild(item);
      });
    }

    function exportHistory() {
      const blob = new Blob([JSON.stringify({ messages, credits: getCredits(), lang: currentLang }, null, 2)], { type: "application/json" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "avatar-g-history.json";
      document.body.appendChild(a);
      a.click();
      a.remove();
      URL.revokeObjectURL(url);
      toastMsg("âœ… Exported", "success");
    }

    function clearHistory() {
      localStorage.setItem(STORE_MESSAGES, JSON.stringify([]));
      messages = [];
      rerenderChatFromState();
      renderHistory();
      toastMsg("âœ… Cleared", "success");
    }

    function toastMsg(msg, type="") {
      toast.textContent = msg;
      toast.className = "toast show";
      if (type) toast.classList.add(type);
      setTimeout(() => {
        toast.classList.remove("show");
        setTimeout(() => toast.className = "toast", 280);
      }, 2800);
    }

    langSel.addEventListener("change", (e) => applyLang(e.target.value));

    document.querySelectorAll(".serviceCard").forEach(card => {
      const activate = () => {
        const service = card.dataset.service;
        setActiveService(service);
        toastMsg(tr().serviceActive(service), "success");
      };
      card.addEventListener("click", activate);
      card.addEventListener("keydown", (e) => {
        if (e.key === "Enter" || e.key === " ") { e.preventDefault(); activate(); }
      });
    });

    document.querySelectorAll("[data-quick]").forEach(btn => {
      btn.addEventListener("click", () => {
        const service = btn.dataset.quick;
        setActiveService(service);
        mainInput.focus();
      });
    });

    removeServiceTag.addEventListener("click", () => setActiveService(null));

    sendBtn.addEventListener("click", handleSend);
    mainInput.addEventListener("keydown", (e) => {
      if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        handleSend();
      }
    });

    mainInput.addEventListener("input", function(){
      this.style.height = "auto";
      this.style.height = Math.min(this.scrollHeight, 130) + "px";
    });

    attachBtn.addEventListener("click", () => fileInput.click());
    fileInput.addEventListener("change", () => {
      const files = Array.from(fileInput.files || []);
      if (!files.length) return;
      const maxFiles = 6;
      attachments = attachments.concat(files.slice(0, maxFiles - attachments.length)).map(f => ({ name: f.name, size: f.size }));
      renderAttachments();
      fileInput.value = "";
      toastMsg("âœ… Attached", "success");
    });

    promptBtn.addEventListener("click", openPromptBuilder);
    promptCloseBtn.addEventListener("click", closePromptBuilder);
    promptCancelBtn.addEventListener("click", closePromptBuilder);
    promptUseBtn.addEventListener("click", usePrompt);
    promptService.addEventListener("change", (e) => renderTemplates(e.target.value));

    aiHelperBtn.addEventListener("click", openHelper);
    helperCloseBtn.addEventListener("click", closeHelper);
    helperCancelBtn.addEventListener("click", closeHelper);
    helperAskBtn.addEventListener("click", askHelper);

    historyBtn.addEventListener("click", openHistory);
    historyCloseBtn.addEventListener("click", closeHistory);
    historyCancelBtn.addEventListener("click", closeHistory);
    exportBtn.addEventListener("click", exportHistory);
    clearBtn.addEventListener("click", clearHistory);

    function goHome() {
      setActiveService(null);
      if (!messages.length) {
        emptyState.style.display = "";
        chatContainer.scrollTop = 0;
      } else {
        chatContainer.scrollTop = 0;
      }
      toastMsg("âœ… Home", "success");
    }
    homeBtn.addEventListener("click", goHome);
    homeBtn.addEventListener("keydown", (e) => {
      if (e.key === "Enter" || e.key === " ") { e.preventDefault(); goHome(); }
    });

    resetCreditsBtn.addEventListener("click", () => {
      setCredits(CREDIT_DEFAULT);
      toastMsg("âœ… Credits reset", "success");
    });

    [promptOverlay, helperOverlay, historyOverlay].forEach(ov => {
      ov.addEventListener("click", (e) => { if (e.target === ov) ov.classList.contains("show") && (ov === promptOverlay ? closePromptBuilder() : ov === helperOverlay ? closeHelper() : closeHistory()); });
    });

    document.addEventListener("keydown", (e) => {
      if (e.key === "Escape") {
        if (promptOverlay.classList.contains("show")) closePromptBuilder();
        if (helperOverlay.classList.contains("show")) closeHelper();
        if (historyOverlay.classList.contains("show")) closeHistory();
      }
    });

    initStorage();

    currentLang = localStorage.getItem(STORE_LANG) || "ka";
    langSel.value = currentLang;
    applyLang(currentLang);

    updateCreditsDisplay();

    messages = safeJSONParse(localStorage.getItem(STORE_MESSAGES) || "[]", []);
    rerenderChatFromState();

    const persistedService = (localStorage.getItem(STORE_SERVICE) || "").trim();
    if (persistedService) setActiveService(persistedService);

    console.log("%cğŸš€ Avatar G AI Workspace", "font-size:22px;font-weight:900;color:#22d3ee;background:linear-gradient(135deg, rgba(34,211,238,.12), rgba(59,130,246,.08));padding:12px 20px;border-radius:8px;");
    console.log("%câœ¨ Production-ready. Made with â¤ï¸ in Georgia.", "font-size:14px;color:#93a3b8;font-weight:600;");
  </script>
</body>
</html>
